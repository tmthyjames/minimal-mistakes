---
title: "SQLCell Part I: The Basics"
author_profile: true
author: Tim Dobbins
excerpt: This is a tool I wrote to write SQL queries in a Jupyter notebook
categories: [tools]
tags: [SQL, python, jupyter-notebook, JavaScript, data-science]
---
<link rel="stylesheet" type="text/css" href="/assets/css/ipython.css"><style>

div.output_area{max-height:500px;}
.button-sect{margin:2px;}
</style><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 147px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable-2">* </span><span class="cm-link cm-variable-2">[Description]</span><span class="cm-string cm-url cm-variable-2">(#Description)</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable-2">* </span><span class="cm-link cm-variable-2">[Installation]</span><span class="cm-string cm-url cm-variable-2">(#Installation)</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable-2">* </span><span class="cm-link cm-variable-2">[Buttons]</span><span class="cm-string cm-url cm-variable-2">(#Buttons)</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable-2">* </span><span class="cm-link cm-variable-2">[Declaring Engines]</span><span class="cm-string cm-url cm-variable-2">(#Declaring-Engines)</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable-2">* </span><span class="cm-link cm-variable-2">[Passing variables from Python to SQL]</span><span class="cm-string cm-url cm-variable-2">(#Passing-variables-from-Python-to-SQL)</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable-2">* </span><span class="cm-link cm-variable-2">[Pass output from SQL to Python]</span><span class="cm-string cm-url cm-variable-2">(#Pass-output-from-SQL-to-Python)</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable-2">* </span><span class="cm-link cm-variable-2">[Query plan as color coded table or graph]</span><span class="cm-string cm-url cm-variable-2">(#Query-plan-as-color-coded-table-or-graph)</span></span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 177px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><ul>
<li><a href="#Description">Description</a></li>
<li><a href="#Installation">Installation</a></li>
<li><a href="#Buttons">Buttons</a></li>
<li><a href="#Declaring-Engines">Declaring Engines</a></li>
<li><a href="#Passing-variables-from-Python-to-SQL">Passing variables from Python to SQL</a></li>
<li><a href="#Pass-output-from-SQL-to-Python">Pass output from SQL to Python</a></li>
<li><a href="#Query-plan-as-color-coded-table-or-graph">Query plan as color coded table or graph</a></li>
</ul>
</div></div></div><div class="cell text_cell un rendered" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 169px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-header cm-header-2">## Description</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">This project came about after I got tired of importing SQLAlchemy everytime I wanted to run a query. You should just be able to query your database directly from Jupyter, right? That's what this project accomplishes—along with many other fetaures that make it more like a SQL GUI than a Jupyter plugin.</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">First, we need to pull down a copy of the project from <span class="cm-link">[here]</span><span class="cm-string cm-url">(https://github.com/tmthyjames/SQLCell)</span>.</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 199px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><h2 id="Description">Description<a class="anchor-link" href="#Description">¶</a></h2>
<p>This project came about after I got tired of importing SQLAlchemy everytime I wanted to run a query. You should just be able to query your database directly from Jupyter, right? That's what this project accomplishes—along with many other fetaures that make it more like a SQL GUI than a Jupyter plugin.</p>
<p>First, we need to pull down a copy of the project from <a href="https://github.com/tmthyjames/SQLCell" target="_blank">here</a>.</p>
</div></div></div><div class="cell text_cell un rendered" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 33px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-header cm-header-2">## Installation</span></span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 63px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><h2 id="Installation">Installation<a class="anchor-link" href="#Installation">¶</a></h2>
</div></div></div><div class="cell text_cell un rendered" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 232px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">Just <span class="cm-comment">`git clone`</span> the repo and <span class="cm-comment">`cp`</span> the <span class="cm-comment">`sqlcell_app.py`</span> file to Jupyter's startup directory (on my computer, the directory is <span class="cm-comment">`~/.ipython/profile_default/startup`</span>, but may be different depending on your OS and version of IPython/Jupyter) like so:</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">```</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-delimit cm-delimit-open">$</span> cd .ipython/profile_default/startup # your start up directory here</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-delimit cm-delimit-close">$</span> <span class="cm-comment">git clone https://github.com/tmthyjames/SQLCell.git</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-delimit cm-delimit-open">$</span> cp SQLCell/sqlcell_app.py sqlcell_app.py # cp sqlcell_app.py to the startup folder so it will get executed</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">```</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">Now, just use the `ENGINE` parameter along with your connection string and give it a go.</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 262px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><p>Just <code>git clone</code> the repo and <code>cp</code> the <code>sqlcell_app.py</code> file to Jupyter's startup directory (on my computer, the directory is <code>~/.ipython/profile_default/startup</code>, but may be different depending on your OS and version of IPython/Jupyter) like so:</p>
<pre><code>$ cd .ipython/profile_default/startup # your start up directory here
$ git clone https://github.com/tmthyjames/SQLCell.git
$ cp SQLCell/sqlcell_app.py sqlcell_app.py # cp sqlcell_app.py to the startup folder so it will get executed
</code></pre><p>Now, just use the <code>ENGINE</code> parameter along with your connection string and give it a go.</p>
</div></div></div><div class="cell code_cell rendered un" tabs="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[5]:</div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 518.703px; margin-bottom: 0px; border-right-width: 30px; min-height: 45px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-magic">%%sql ENGINE='postgresql://tdobbins:tdobbins@localhost:5432/sports'</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">select</span> * <span class="cm-keyword">from</span> nba <span class="cm-keyword">limit</span> <span class="cm-number">5</span></span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 75px;"></div></div></div></div></div></div><div class="widget-area connection-problems" style="display: none;"><div class="prompt"><button class="close">×</button></div><div class="widget-subarea"></div></div><div class="output_wrapper"><div class=" prompt" title="click to scroll output; double click to hide" style=""></div><div class="output" style=""><div class="output_area"><div class="prompt"></div><div class="output_subarea output_html rendered_html">
        <style>
        .input { 
            position:relative; 
        }
        #childDivf12574fc-a607-4885-8775-1330c8eb2969 { 
            width: 90%;
            position:absolute; 
        }
        #tablef12574fc-a607-4885-8775-1330c8eb2969{
            padding-top: 60px;
        }
        .page__content p {
            margin: inherit !important;
        }
        .smallfont {
            font-size: 12px !important;
        }
        </style>
        <div class="row" id="childDivf12574fc-a607-4885-8775-1330c8eb2969">
            <div class="btn-group col-md-3">
                <button id="explain" title="Explain Analyze Graph" onclick="explain('__EXPLAIN_GRAPH__')" type="button" class="btn btn-info btn-sm"><p class="fa fa-code-fork fa-rotate-270" <="" p=""></p></button>
                <button id="explain" title="Explain Analyze" onclick="explain('__EXPLAIN__')" type="button" class="btn btn-info btn-sm"><p class="fa fa-info-circle" <="" p=""></p></button>
                <button type="button" title="Execute" onclick="run()" class="btn btn-success btn-sm"><p class="fa fa-play"></p></button>
                <button type="button" title="Execute and Return Data as Variable" onclick="getData()" class="btn btn-success btn-sm"><p class="">var</p></button>
                <button id="saveDataf12574fc-a607-4885-8775-1330c8eb2969" title="Save" class="btn btn-success btn-sm" type="button"><p class="fa fa-save" <="" p=""></p></button>
                <button id="cancelQueryf12574fc-a607-4885-8775-1330c8eb2969" title="Cancel Query" class="btn btn-danger btn-sm disabled" type="button"><p class="fa fa-stop" <="" p=""></p></button>
            </div>
            <div id="engineButtonsf12574fc-a607-4885-8775-1330c8eb2969" class="btn-group col-md-4"><button title="Switch Engine" onclick="switchEngines('LOCAL')" class="btn btn-warning btn-sm">LOCAL</button></div>
            <div id="tableDataf12574fc-a607-4885-8775-1330c8eb2969"><p class="smallfont" id="dbinfof12574fc-a607-4885-8775-1330c8eb2969">To execute: 0.01 sec | Rows: 5 | DB: sports | Host: localhost | READ MODE</p></div>
        </div>
        <div class="table" id="tablef12574fc-a607-4885-8775-1330c8eb2969"><table class="table-striped table-hover" id="tablef12574fc-a607-4885-8775-1330c8eb2969" width="100%"><thead><tr><th> </th><th>dateof</th><th>team</th><th>opp</th><th>pts</th><th>fg</th><th>fg_att</th><th>ft</th><th>ft_att</th><th>fg3</th><th>fg3_att</th><th>off_rebounds</th><th>def_rebounds</th><th>asst</th><th>blks</th><th>fouls</th><th>stls</th><th>turnovers</th></tr></thead><tbody><tr><td>1</td><td tabs="1" data-column="2015-10-27">2015-10-27</td><td tabs="1" data-column="DET">DET</td><td tabs="1" data-column="ATL">ATL</td><td tabs="1" data-column="106">106</td><td tabs="1" data-column="37">37</td><td tabs="1" data-column="96">96</td><td tabs="1" data-column="20">20</td><td tabs="1" data-column="26">26</td><td tabs="1" data-column="12">12</td><td tabs="1" data-column="29">29</td><td tabs="1" data-column="23">23</td><td tabs="1" data-column="36">36</td><td tabs="1" data-column="23">23</td><td tabs="1" data-column="3">3</td><td tabs="1" data-column="15">15</td><td tabs="1" data-column="5">5</td><td tabs="1" data-column="15">15</td></tr><tr><td>2</td><td tabs="1" data-column="2015-10-27">2015-10-27</td><td tabs="1" data-column="ATL">ATL</td><td tabs="1" data-column="DET">DET</td><td tabs="1" data-column="94">94</td><td tabs="1" data-column="37">37</td><td tabs="1" data-column="82">82</td><td tabs="1" data-column="12">12</td><td tabs="1" data-column="15">15</td><td tabs="1" data-column="8">8</td><td tabs="1" data-column="27">27</td><td tabs="1" data-column="7">7</td><td tabs="1" data-column="33">33</td><td tabs="1" data-column="22">22</td><td tabs="1" data-column="4">4</td><td tabs="1" data-column="25">25</td><td tabs="1" data-column="9">9</td><td tabs="1" data-column="15">15</td></tr><tr><td>3</td><td tabs="1" data-column="2015-10-27">2015-10-27</td><td tabs="1" data-column="CLE">CLE</td><td tabs="1" data-column="CHI">CHI</td><td tabs="1" data-column="95">95</td><td tabs="1" data-column="38">38</td><td tabs="1" data-column="94">94</td><td tabs="1" data-column="10">10</td><td tabs="1" data-column="17">17</td><td tabs="1" data-column="9">9</td><td tabs="1" data-column="29">29</td><td tabs="1" data-column="11">11</td><td tabs="1" data-column="39">39</td><td tabs="1" data-column="26">26</td><td tabs="1" data-column="7">7</td><td tabs="1" data-column="21">21</td><td tabs="1" data-column="5">5</td><td tabs="1" data-column="11">11</td></tr><tr><td>4</td><td tabs="1" data-column="2015-10-27">2015-10-27</td><td tabs="1" data-column="CHI">CHI</td><td tabs="1" data-column="CLE">CLE</td><td tabs="1" data-column="97">97</td><td tabs="1" data-column="37">37</td><td tabs="1" data-column="87">87</td><td tabs="1" data-column="16">16</td><td tabs="1" data-column="23">23</td><td tabs="1" data-column="7">7</td><td tabs="1" data-column="19">19</td><td tabs="1" data-column="7">7</td><td tabs="1" data-column="40">40</td><td tabs="1" data-column="13">13</td><td tabs="1" data-column="10">10</td><td tabs="1" data-column="22">22</td><td tabs="1" data-column="6">6</td><td tabs="1" data-column="13">13</td></tr><tr><td>5</td><td tabs="1" data-column="2015-10-27">2015-10-27</td><td tabs="1" data-column="NO">NO</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="95">95</td><td tabs="1" data-column="35">35</td><td tabs="1" data-column="83">83</td><td tabs="1" data-column="19">19</td><td tabs="1" data-column="27">27</td><td tabs="1" data-column="6">6</td><td tabs="1" data-column="18">18</td><td tabs="1" data-column="8">8</td><td tabs="1" data-column="25">25</td><td tabs="1" data-column="21">21</td><td tabs="1" data-column="3">3</td><td tabs="1" data-column="26">26</td><td tabs="1" data-column="9">9</td><td tabs="1" data-column="19">19</td></tr></tbody></table></div>
        <script type="text/Javascript">




        
            var engines = JSON.parse(`{"LOCAL": {"engine": "postgresql://tdobbins:tdobbins@localhost:5432/", "caution_level": "warning", "order": 0}}`);
            
            var sortedEngineKeys = Object.keys(engines).sort(function(a,b){
                return engines[a].order - engines[b].order;
            });
            
            var sortedEngines = sortedEngineKeys.reduce(function(output, row, idx){
                engines[row]['key'] = row;
                output.push(engines[row]);
                return output;
            }, []);
            
            var engineButtons = '';
            for (var engine in sortedEngines){
                var engineKey = sortedEngines[engine].key;
                var warningLabel = sortedEngines[engine].caution_level;
                engineButtons += '<button title="Switch Engine" onclick="switchEngines('+"'"+engineKey+"'"+')" class="btn btn-'+warningLabel+' btn-sm">'+engineKey+'</button>';
            };
            
           $("#engineButtonsf12574fc-a607-4885-8775-1330c8eb2969").append(engineButtons);
           
           $("#cancelQueryf12574fc-a607-4885-8775-1330c8eb2969").on('click', function(){
               if ($("#cancelQueryf12574fc-a607-4885-8775-1330c8eb2969").hasClass('disabled')){
                   console.log('alread stopped or finished query...');
               } else {
                   cancelQuery("bc3f9cef-42d0-4445-a0cd-b0e2d7791bcc");
                   //$("#cancelQueryf12574fc-a607-4885-8775-1330c8eb2969").addClass('disabled')
               }
           });
        
            function explain(gloVar){
                var command =  `__SQLCell_GLOBAL_VARS__.`+gloVar+` = True`;
                console.log(command);
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                IPython.notebook.execute_cell();
            };
            
            function run(){
                IPython.notebook.execute_cell();
                $.get('/api/contents', function(data){
                    console.log(data);
                });
            };
            
            function cancelQuery(applicationID){
                IPython.notebook.kernel.execute('__SQLCell_GLOBAL_VARS__().kill_last_pid_on_new_thread(__SQLCell_GLOBAL_VARS__.jupyter_id, "sports", "f12574fc-a607-4885-8775-1330c8eb2969")',
                    {
                        iopub: {
                            output: function(response) {
                                var $table = $("#tablef12574fc-a607-4885-8775-1330c8eb2969").parent();
                                console.log(response);
                                if (response.content && response.content.text){
                                    $table.append('<h5 style="color:#d9534f;">'+response.content.text+'</h5>')
                                } else if (response.content && response.content.evalue){
                                    $table.append('<h5 style="color:#d9534f;">'+response.content.evalue+'</h5>');
                                }
                            }
                        }
                    },
                    {
                        silent: false, 
                        store_history: false, 
                        stop_on_error: true
                    }
                );
            };
            
            function getData(){
                var command = `__SQLCell_GLOBAL_VARS__.__GETDATA__ = True`;
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                IPython.notebook.execute_cell();
            };
            
            function saveData(data, filename){
                var path = $('#path').val() || './'
                var command = `__SQLCell_GLOBAL_VARS__.__SAVEDATA__, PATH = True,'`+path+`'`;
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                //IPython.notebook.execute_cell();
                
                function download(data, filename, type) {
                    var a = document.createElement("a"),
                        file = new Blob([data], {type: type});
                    if (window.navigator.msSaveOrOpenBlob) // IE10+
                        window.navigator.msSaveOrOpenBlob(file, filename);
                    else { // Others
                        var url = URL.createObjectURL(file);
                        a.href = url;
                        a.download = filename;
                        document.body.appendChild(a);
                        a.click();
                        setTimeout(function() {
                            document.body.removeChild(a);
                            window.URL.revokeObjectURL(url);  
                        }, 0); 
                    }
                }
                
                download(data, filename, 'csv');
                
            };
            
            function switchEngines(engine){
                var command = "__SQLCell_GLOBAL_VARS__.ENGINE = " + "'" + engines[engine].engine + "sports" + "'";
                var kernel = IPython.notebook.kernel;
                kernel.execute(command,{
                    iopub: {
                        output: function(response) {
                            var $table = $("#tablef12574fc-a607-4885-8775-1330c8eb2969").parent();
                            console.log(response);
                            if (response.content && response.content.text){
                                $table.append('<h5 style="color:#d9534f;">'+response.content.text+'</h5>')
                            } else if (response.content && response.content.evalue){
                                $table.append('<h5 style="color:#d9534f;">'+response.content.evalue+'</h5>');
                            }
                        }
                    }
                },
                    {
                        silent: false, 
                        store_history: false, 
                        stop_on_error: true
                    }
                );
                IPython.notebook.execute_cell();
            };

        </script>
        </div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 33px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-header cm-header-2">## Buttons</span></span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 63px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><h2 id="Buttons">Buttons<a class="anchor-link" href="#Buttons">¶</a></h2>
</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 90.5938px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1" draggable="false"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 470px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">As you can see, this outputs a few things. You get your data for one, but you also get access to a lot of other functionality. For instance, the button group on the left allows you to:</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">br</span><span class="cm-tag cm-bracket">/&gt;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">&amp;emsp;&amp;emsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">button</span> <span class="cm-attribute">title</span>=<span class="cm-string">"Explain Analyze Graph"</span> <span class="cm-attribute">type</span>=<span class="cm-string">"button"</span> <span class="cm-attribute">class</span>=<span class="cm-string">"btn btn-info btn-sm button-sect"</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">p</span> <span class="cm-attribute">class</span>=<span class="cm-string">"fa fa-code-fork fa-rotate-270"</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">button</span><span class="cm-tag cm-bracket">&gt;</span> Run <span class="cm-comment">`EXPLAIN ANALYZE`</span> query and return D3.js sankey chart for analysis.</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">&amp;emsp;&amp;emsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">button</span> <span class="cm-attribute">title</span>=<span class="cm-string">"Explain Analyze"</span> <span class="cm-attribute">type</span>=<span class="cm-string">"button"</span> <span class="cm-attribute">class</span>=<span class="cm-string">"btn btn-info btn-sm button-sect"</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">p</span> <span class="cm-attribute">class</span>=<span class="cm-string">"fa fa-info-circle"</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">button</span><span class="cm-tag cm-bracket">&gt;</span> Run <span class="cm-comment">`EXPLAIN ANALYZE`</span> query and return color-coded table for analysis.</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">&amp;emsp;&amp;emsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">button</span> <span class="cm-attribute">type</span>=<span class="cm-string">"button"</span> <span class="cm-attribute">title</span>=<span class="cm-string">"Execute"</span> <span class="cm-attribute">class</span>=<span class="cm-string">"btn btn-success btn-sm button-sect"</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">p</span> <span class="cm-attribute">class</span>=<span class="cm-string">"fa fa-play"</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">button</span><span class="cm-tag cm-bracket">&gt;</span> Execute your query.</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">&amp;emsp;&amp;emsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">button</span> <span class="cm-attribute">type</span>=<span class="cm-string">"button"</span> <span class="cm-attribute">title</span>=<span class="cm-string">"Execute and Return Data as Variable"</span> <span class="cm-attribute">class</span>=<span class="cm-string">"btn btn-success btn-sm button-sect"</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">p</span> <span class="cm-attribute">class</span>=<span class="cm-string">""</span><span class="cm-tag cm-bracket">&gt;</span>var<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">button</span><span class="cm-tag cm-bracket">&gt;</span> Save the output of your query to a pandas dataframe.</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">&amp;emsp;&amp;emsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">button</span> <span class="cm-attribute">title</span>=<span class="cm-string">"Save"</span> <span class="cm-attribute">class</span>=<span class="cm-string">"btn btn-success btn-sm button-sect"</span> <span class="cm-attribute">type</span>=<span class="cm-string">"button"</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">p</span> <span class="cm-attribute">class</span>=<span class="cm-string">"fa fa-save"</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">button</span><span class="cm-tag cm-bracket">&gt;</span> Save the results of your query to a TSV.</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">&amp;emsp;&amp;emsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">button</span> <span class="cm-attribute">title</span>=<span class="cm-string">"Cancel Query"</span> <span class="cm-attribute">class</span>=<span class="cm-string">"button-sect btn btn-danger btn-sm"</span> <span class="cm-attribute">type</span>=<span class="cm-string">"button"</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">p</span> <span class="cm-attribute">class</span>=<span class="cm-string">"fa fa-stop"</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">button</span><span class="cm-tag cm-bracket">&gt;</span> Halt your query.</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 500px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><p>As you can see, this outputs a few things. You get your data for one, but you also get access to a lot of other functionality. For instance, the button group on the left allows you to:</p>
<p><br></p>
<p>  <button title="Explain Analyze Graph" type="button" class="btn btn-info btn-sm button-sect"><p class="fa fa-code-fork fa-rotate-270"></p></button> Run <code>EXPLAIN ANALYZE</code> query and return D3.js sankey chart for analysis.</p>
<p>  <button title="Explain Analyze" type="button" class="btn btn-info btn-sm button-sect"><p class="fa fa-info-circle"></p></button> Run <code>EXPLAIN ANALYZE</code> query and return color-coded table for analysis.</p>
<p>  <button type="button" title="Execute" class="btn btn-success btn-sm button-sect"><p class="fa fa-play"></p></button> Execute your query.</p>
<p>  <button type="button" title="Execute and Return Data as Variable" class="btn btn-success btn-sm button-sect"><p class="">var</p></button> Save the output of your query to a pandas dataframe.</p>
<p>  <button title="Save" class="btn btn-success btn-sm button-sect" type="button"><p class="fa fa-save"></p></button> Save the results of your query to a TSV.</p>
<p>  <button title="Cancel Query" class="button-sect btn btn-danger btn-sm" type="button"><p class="fa fa-stop"></p></button> Halt your query.</p>
</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 62px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">The button on the right is an execute button. Instead of using <span class="cm-comment">`shift + enter`</span> to run your query you can just press that button. This turns into a group of buttons when you declare more than one engine. More on this in the net section.</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><p>The button on the right is an execute button. Instead of using <code>shift + enter</code> to run your query you can just press that button. This turns into a group of buttons when you declare more than one engine. More on this in the net section.</p>
</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 33px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-header cm-header-2">## Declaring Engines</span></span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 63px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><h2 id="Declaring-Engines">Declaring Engines<a class="anchor-link" href="#Declaring-Engines">¶</a></h2>
</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 45px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">You can save the connection string with the <span class="cm-comment">`declare_engines`</span> flag. This will allow you to run queries without specifying the <span class="cm-comment">`ENGINE`</span> parameter as in our first query.</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 75px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><p>You can save the connection string with the <code>declare_engines</code> flag. This will allow you to run queries without specifying the <code>ENGINE</code> parameter as in our first query.</p>
</div></div></div><div class="cell code_cell rendered un" tabs="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[6]:</div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 403px; margin-bottom: 0px; border-right-width: 30px; min-height: 45px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-magic">%%sql --declare_engines new</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">LOCAL=postgresql://tdobbins:tdobbins@localhost:5432/</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 75px;"></div></div></div></div></div></div><div class="widget-area connection-problems" style="display: none;"><div class="prompt"><button class="close">×</button></div><div class="widget-subarea"></div></div><div class="output_wrapper"><div class=" prompt" title="click to scroll output; double click to hide" style=""></div><div class="output" style=""><div class="output_area"><div class="prompt"></div><div class="output_subarea output_html rendered_html">
        <style>
        .input { 
            position:relative; 
        }
        #childDivee148eb6-fb38-45f0-a204-7a203226d4db { 
            width: 90%;
            position:absolute; 
        }
        #tableee148eb6-fb38-45f0-a204-7a203226d4db{
            padding-top: 60px;
        }
        .page__content p {
            margin: inherit !important;
        }
        .smallfont {
            font-size: 12px !important;
        }
        </style>
        <div class="row" id="childDivee148eb6-fb38-45f0-a204-7a203226d4db">
            <div class="btn-group col-md-3">
                <button id="explain" title="Explain Analyze Graph" onclick="explain('__EXPLAIN_GRAPH__')" type="button" class="btn btn-info btn-sm"><p class="fa fa-code-fork fa-rotate-270" <="" p=""></p></button>
                <button id="explain" title="Explain Analyze" onclick="explain('__EXPLAIN__')" type="button" class="btn btn-info btn-sm"><p class="fa fa-info-circle" <="" p=""></p></button>
                <button type="button" title="Execute" onclick="run()" class="btn btn-success btn-sm"><p class="fa fa-play"></p></button>
                <button type="button" title="Execute and Return Data as Variable" onclick="getData()" class="btn btn-success btn-sm"><p class="">var</p></button>
                <button id="saveDataee148eb6-fb38-45f0-a204-7a203226d4db" title="Save" class="btn btn-success btn-sm disabled" type="button"><p class="fa fa-save" <="" p=""></p></button>
                <button id="cancelQueryee148eb6-fb38-45f0-a204-7a203226d4db" title="Cancel Query" class="btn btn-danger btn-sm" type="button"><p class="fa fa-stop" <="" p=""></p></button>
            </div>
            <div id="engineButtonsee148eb6-fb38-45f0-a204-7a203226d4db" class="btn-group col-md-4"><button title="Switch Engine" onclick="switchEngines('LOCAL')" class="btn btn-warning btn-sm">LOCAL</button></div>
            <div id="tableDataee148eb6-fb38-45f0-a204-7a203226d4db"></div>
        </div>
        <div class="table" id="tableee148eb6-fb38-45f0-a204-7a203226d4db"></div>
        <script type="text/Javascript">




        
            var engines = JSON.parse(`{"LOCAL": {"engine": "postgresql://tdobbins:tdobbins@localhost:5432/", "caution_level": "warning", "order": 0}}`);
            
            var sortedEngineKeys = Object.keys(engines).sort(function(a,b){
                return engines[a].order - engines[b].order;
            });
            
            var sortedEngines = sortedEngineKeys.reduce(function(output, row, idx){
                engines[row]['key'] = row;
                output.push(engines[row]);
                return output;
            }, []);
            
            var engineButtons = '';
            for (var engine in sortedEngines){
                var engineKey = sortedEngines[engine].key;
                var warningLabel = sortedEngines[engine].caution_level;
                engineButtons += '<button title="Switch Engine" onclick="switchEngines('+"'"+engineKey+"'"+')" class="btn btn-'+warningLabel+' btn-sm">'+engineKey+'</button>';
            };
            
           $("#engineButtonsee148eb6-fb38-45f0-a204-7a203226d4db").append(engineButtons);
           
           $("#cancelQueryee148eb6-fb38-45f0-a204-7a203226d4db").on('click', function(){
               if ($("#cancelQueryee148eb6-fb38-45f0-a204-7a203226d4db").hasClass('disabled')){
                   console.log('alread stopped or finished query...');
               } else {
                   cancelQuery("bc3f9cef-42d0-4445-a0cd-b0e2d7791bcc");
                   //$("#cancelQueryee148eb6-fb38-45f0-a204-7a203226d4db").addClass('disabled')
               }
           });
        
            function explain(gloVar){
                var command =  `__SQLCell_GLOBAL_VARS__.`+gloVar+` = True`;
                console.log(command);
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                IPython.notebook.execute_cell();
            };
            
            function run(){
                IPython.notebook.execute_cell();
                $.get('/api/contents', function(data){
                    console.log(data);
                });
            };
            
            function cancelQuery(applicationID){
                IPython.notebook.kernel.execute('__SQLCell_GLOBAL_VARS__().kill_last_pid_on_new_thread(__SQLCell_GLOBAL_VARS__.jupyter_id, "econ", "ee148eb6-fb38-45f0-a204-7a203226d4db")',
                    {
                        iopub: {
                            output: function(response) {
                                var $table = $("#tableee148eb6-fb38-45f0-a204-7a203226d4db").parent();
                                console.log(response);
                                if (response.content && response.content.text){
                                    $table.append('<h5 style="color:#d9534f;">'+response.content.text+'</h5>')
                                } else if (response.content && response.content.evalue){
                                    $table.append('<h5 style="color:#d9534f;">'+response.content.evalue+'</h5>');
                                }
                            }
                        }
                    },
                    {
                        silent: false, 
                        store_history: false, 
                        stop_on_error: true
                    }
                );
            };
            
            function getData(){
                var command = `__SQLCell_GLOBAL_VARS__.__GETDATA__ = True`;
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                IPython.notebook.execute_cell();
            };
            
            function saveData(data, filename){
                var path = $('#path').val() || './'
                var command = `__SQLCell_GLOBAL_VARS__.__SAVEDATA__, PATH = True,'`+path+`'`;
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                //IPython.notebook.execute_cell();
                
                function download(data, filename, type) {
                    var a = document.createElement("a"),
                        file = new Blob([data], {type: type});
                    if (window.navigator.msSaveOrOpenBlob) // IE10+
                        window.navigator.msSaveOrOpenBlob(file, filename);
                    else { // Others
                        var url = URL.createObjectURL(file);
                        a.href = url;
                        a.download = filename;
                        document.body.appendChild(a);
                        a.click();
                        setTimeout(function() {
                            document.body.removeChild(a);
                            window.URL.revokeObjectURL(url);  
                        }, 0); 
                    }
                }
                
                download(data, filename, 'csv');
                
            };
            
            function switchEngines(engine){
                var command = "__SQLCell_GLOBAL_VARS__.ENGINE = " + "'" + engines[engine].engine + "econ" + "'";
                var kernel = IPython.notebook.kernel;
                kernel.execute(command,{
                    iopub: {
                        output: function(response) {
                            var $table = $("#tableee148eb6-fb38-45f0-a204-7a203226d4db").parent();
                            console.log(response);
                            if (response.content && response.content.text){
                                $table.append('<h5 style="color:#d9534f;">'+response.content.text+'</h5>')
                            } else if (response.content && response.content.evalue){
                                $table.append('<h5 style="color:#d9534f;">'+response.content.evalue+'</h5>');
                            }
                        }
                    }
                },
                    {
                        silent: false, 
                        store_history: false, 
                        stop_on_error: true
                    }
                );
                IPython.notebook.execute_cell();
            };

        </script>
        </div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_text output_stream output_stdout"><pre>new engines created
</pre></div></div></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 96px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">To declare multiple engines, you can use the <span class="cm-comment">`append`</span> argument, or you can specify multiple in your initial engine declaration. Let's use the <span class="cm-comment">`append`</span> argument here. I have two other postgres instances I will declare, one RDS and one EC2. The right side of the equation is what the button text will be; the left side is the connection string.</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 126px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><p>To declare multiple engines, you can use the <code>append</code> argument, or you can specify multiple in your initial engine declaration. Let's use the <code>append</code> argument here. I have two other postgres instances I will declare, one RDS and one EC2. The right side of the equation is what the button text will be; the left side is the connection string.</p>
</div></div></div><div class="cell code_cell rendered un" tabs="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[8]:</div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 726px; margin-bottom: 0px; border-right-width: 30px; min-height: 62px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-magic">%%sql --declare_engines append</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">RDS=postgresql://tmthyjames:1q2w3e4r5t@orionpax<span class="cm-variable-2">.cvb</span><span class="cm-number">2</span>tnvqksy5<span class="cm-variable-2">.us</span>-east-<span class="cm-number">1</span><span class="cm-variable-2">.rds.amazonaws.com</span>:5432/</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">EC2=postgresql://tmthyjames:1q2w3e4r5t@ec2-<span class="cm-number">34</span>-<span class="cm-number">204</span>-<span class="cm-number">5</span>-<span class="cm-number">97</span><span class="cm-variable-2">.compute</span>-<span class="cm-number">1</span><span class="cm-variable-2">.amazonaws.com</span>:5432/</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></div></div></div><div class="widget-area connection-problems" style="display: none;"><div class="prompt"><button class="close">×</button></div><div class="widget-subarea"></div></div><div class="output_wrapper"><div class=" prompt" title="click to scroll output; double click to hide" style=""></div><div class="output" style=""><div class="output_area"><div class="prompt"></div><div class="output_subarea output_html rendered_html">
        <style>
        .input { 
            position:relative; 
        }
        #childDiv0eae12f5-45f1-4772-98f0-5eb472244953 { 
            width: 90%;
            position:absolute; 
        }
        #table0eae12f5-45f1-4772-98f0-5eb472244953{
            padding-top: 60px;
        }
        .page__content p {
            margin: inherit !important;
        }
        .smallfont {
            font-size: 12px !important;
        }
        </style>
        <div class="row" id="childDiv0eae12f5-45f1-4772-98f0-5eb472244953">
            <div class="btn-group col-md-3">
                <button id="explain" title="Explain Analyze Graph" onclick="explain('__EXPLAIN_GRAPH__')" type="button" class="btn btn-info btn-sm"><p class="fa fa-code-fork fa-rotate-270" <="" p=""></p></button>
                <button id="explain" title="Explain Analyze" onclick="explain('__EXPLAIN__')" type="button" class="btn btn-info btn-sm"><p class="fa fa-info-circle" <="" p=""></p></button>
                <button type="button" title="Execute" onclick="run()" class="btn btn-success btn-sm"><p class="fa fa-play"></p></button>
                <button type="button" title="Execute and Return Data as Variable" onclick="getData()" class="btn btn-success btn-sm"><p class="">var</p></button>
                <button id="saveData0eae12f5-45f1-4772-98f0-5eb472244953" title="Save" class="btn btn-success btn-sm disabled" type="button"><p class="fa fa-save" <="" p=""></p></button>
                <button id="cancelQuery0eae12f5-45f1-4772-98f0-5eb472244953" title="Cancel Query" class="btn btn-danger btn-sm" type="button"><p class="fa fa-stop" <="" p=""></p></button>
            </div>
            <div id="engineButtons0eae12f5-45f1-4772-98f0-5eb472244953" class="btn-group col-md-4"><button title="Switch Engine" onclick="switchEngines('LOCAL')" class="btn btn-warning btn-sm">LOCAL</button><button title="Switch Engine" onclick="switchEngines('RDS')" class="btn btn-warning btn-sm">RDS</button><button title="Switch Engine" onclick="switchEngines('EC2')" class="btn btn-warning btn-sm">EC2</button></div>
            <div id="tableData0eae12f5-45f1-4772-98f0-5eb472244953"></div>
        </div>
        <div class="table" id="table0eae12f5-45f1-4772-98f0-5eb472244953"></div>
        <script type="text/Javascript">




        
            var engines = JSON.parse(`{"LOCAL": {"engine": "postgresql://tdobbins:tdobbins@localhost:5432/", "caution_level": "warning", "order": 0}, "EC2": {"engine": "postgresql://tmthyjames:1q2w3e4r5t@ec2-34-204-5-97.compute-1.amazonaws.com:5432/", "caution_level": "warning", "order": 1}, "RDS": {"engine": "postgresql://tmthyjames:1q2w3e4r5t@orionpax.cvb2tnvqksy5.us-east-1.rds.amazonaws.com:5432/", "caution_level": "warning", "order": 0}}`);
            
            var sortedEngineKeys = Object.keys(engines).sort(function(a,b){
                return engines[a].order - engines[b].order;
            });
            
            var sortedEngines = sortedEngineKeys.reduce(function(output, row, idx){
                engines[row]['key'] = row;
                output.push(engines[row]);
                return output;
            }, []);
            
            var engineButtons = '';
            for (var engine in sortedEngines){
                var engineKey = sortedEngines[engine].key;
                var warningLabel = sortedEngines[engine].caution_level;
                engineButtons += '<button title="Switch Engine" onclick="switchEngines('+"'"+engineKey+"'"+')" class="btn btn-'+warningLabel+' btn-sm">'+engineKey+'</button>';
            };
            
           $("#engineButtons0eae12f5-45f1-4772-98f0-5eb472244953").append(engineButtons);
           
           $("#cancelQuery0eae12f5-45f1-4772-98f0-5eb472244953").on('click', function(){
               if ($("#cancelQuery0eae12f5-45f1-4772-98f0-5eb472244953").hasClass('disabled')){
                   console.log('alread stopped or finished query...');
               } else {
                   cancelQuery("bc3f9cef-42d0-4445-a0cd-b0e2d7791bcc");
                   //$("#cancelQuery0eae12f5-45f1-4772-98f0-5eb472244953").addClass('disabled')
               }
           });
        
            function explain(gloVar){
                var command =  `__SQLCell_GLOBAL_VARS__.`+gloVar+` = True`;
                console.log(command);
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                IPython.notebook.execute_cell();
            };
            
            function run(){
                IPython.notebook.execute_cell();
                $.get('/api/contents', function(data){
                    console.log(data);
                });
            };
            
            function cancelQuery(applicationID){
                IPython.notebook.kernel.execute('__SQLCell_GLOBAL_VARS__().kill_last_pid_on_new_thread(__SQLCell_GLOBAL_VARS__.jupyter_id, "econ", "0eae12f5-45f1-4772-98f0-5eb472244953")',
                    {
                        iopub: {
                            output: function(response) {
                                var $table = $("#table0eae12f5-45f1-4772-98f0-5eb472244953").parent();
                                console.log(response);
                                if (response.content && response.content.text){
                                    $table.append('<h5 style="color:#d9534f;">'+response.content.text+'</h5>')
                                } else if (response.content && response.content.evalue){
                                    $table.append('<h5 style="color:#d9534f;">'+response.content.evalue+'</h5>');
                                }
                            }
                        }
                    },
                    {
                        silent: false, 
                        store_history: false, 
                        stop_on_error: true
                    }
                );
            };
            
            function getData(){
                var command = `__SQLCell_GLOBAL_VARS__.__GETDATA__ = True`;
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                IPython.notebook.execute_cell();
            };
            
            function saveData(data, filename){
                var path = $('#path').val() || './'
                var command = `__SQLCell_GLOBAL_VARS__.__SAVEDATA__, PATH = True,'`+path+`'`;
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                //IPython.notebook.execute_cell();
                
                function download(data, filename, type) {
                    var a = document.createElement("a"),
                        file = new Blob([data], {type: type});
                    if (window.navigator.msSaveOrOpenBlob) // IE10+
                        window.navigator.msSaveOrOpenBlob(file, filename);
                    else { // Others
                        var url = URL.createObjectURL(file);
                        a.href = url;
                        a.download = filename;
                        document.body.appendChild(a);
                        a.click();
                        setTimeout(function() {
                            document.body.removeChild(a);
                            window.URL.revokeObjectURL(url);  
                        }, 0); 
                    }
                }
                
                download(data, filename, 'csv');
                
            };
            
            function switchEngines(engine){
                var command = "__SQLCell_GLOBAL_VARS__.ENGINE = " + "'" + engines[engine].engine + "econ" + "'";
                var kernel = IPython.notebook.kernel;
                kernel.execute(command,{
                    iopub: {
                        output: function(response) {
                            var $table = $("#table0eae12f5-45f1-4772-98f0-5eb472244953").parent();
                            console.log(response);
                            if (response.content && response.content.text){
                                $table.append('<h5 style="color:#d9534f;">'+response.content.text+'</h5>')
                            } else if (response.content && response.content.evalue){
                                $table.append('<h5 style="color:#d9534f;">'+response.content.evalue+'</h5>');
                            }
                        }
                    }
                },
                    {
                        silent: false, 
                        store_history: false, 
                        stop_on_error: true
                    }
                );
                IPython.notebook.execute_cell();
            };

        </script>
        </div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_text output_stream output_stdout"><pre>new engines created
</pre></div></div></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 45px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">Now you can easily switch between different connection engines by pushing the engine's button.</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 75px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><p>Now you can easily switch between different connection engines by pushing the engine's button.</p>
</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 33px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-header cm-header-2">## Passing variables from Python to SQL</span></span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 63px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><h2 id="Passing-variables-from-Python-to-SQL">Passing variables from Python to SQL<a class="anchor-link" href="#Passing-variables-from-Python-to-SQL">¶</a></h2>
</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 79px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">This is my favorite part of SQLCell. The ability to pass variables from Python to SQL makes dynamic queries easier to write, which especially handy for web developers using a wrapper such as SQLAlchemy or something similar. Let's test it out.</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 109px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><p>This is my favorite part of SQLCell. The ability to pass variables from Python to SQL makes dynamic queries easier to write, which especially handy for web developers using a wrapper such as SQLAlchemy or something similar. Let's test it out.</p>
</div></div></div><div class="cell code_cell rendered un" tabs="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[10]:</div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 341.672px; margin-bottom: 0px; border-right-width: 30px; min-height: 96px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment"># in this cell, define your python variables</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">some_int</span> = <span class="cm-number">30</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">some_float</span> = <span class="cm-number">.3</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">some_str</span> = <span class="cm-string">'GS'</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">some_tuple</span> = (<span class="cm-string">'WAS'</span>, <span class="cm-string">'MIN'</span>)</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 126px;"></div></div></div></div></div></div><div class="widget-area connection-problems" style="display: none;"><div class="prompt"><button class="close">×</button></div><div class="widget-subarea"></div></div><div class="output_wrapper"><div class=" prompt" title="click to scroll output; double click to hide" style="display: none;"></div><div class="output" style="display: none;"></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 28px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">Now that we've defined our Python variables, we can construct a dynamic query.</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 58px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><p>Now that we've defined our Python variables, we can construct a dynamic query.</p>
</div></div></div><div class="cell code_cell rendered un" tabs="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[11]:</div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 318.562px; margin-bottom: 0px; border-right-width: 30px; min-height: 130px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-magic">%%sql DB=sports</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> * </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">FROM</span> nba </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">WHERE</span> pts &gt; %(some_int)s</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">AND</span> fg/fg_att::FLOAT &gt; %(some_float)s</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">AND</span> team = %(some_str)s</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">AND</span> opp <span class="cm-keyword">IN</span> %(some_tuple)s</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 160px;"></div></div></div></div></div></div><div class="widget-area connection-problems" style="display: none;"><div class="prompt"><button class="close">×</button></div><div class="widget-subarea"></div></div><div class="output_wrapper"><div class=" prompt" title="click to scroll output; double click to hide" style=""></div><div class="output" style=""><div class="output_area"><div class="prompt"></div><div class="output_subarea output_html rendered_html">
        <style>
        .input { 
            position:relative; 
        }
        #childDivfa0f398a-994a-4ca4-9e8a-181cff7fb08b { 
            width: 90%;
            position:absolute; 
        }
        #tablefa0f398a-994a-4ca4-9e8a-181cff7fb08b{
            padding-top: 60px;
        }
        .page__content p {
            margin: inherit !important;
        }
        .smallfont {
            font-size: 12px !important;
        }
        </style>
        <div class="row" id="childDivfa0f398a-994a-4ca4-9e8a-181cff7fb08b">
            <div class="btn-group col-md-3">
                <button id="explain" title="Explain Analyze Graph" onclick="explain('__EXPLAIN_GRAPH__')" type="button" class="btn btn-info btn-sm"><p class="fa fa-code-fork fa-rotate-270" <="" p=""></p></button>
                <button id="explain" title="Explain Analyze" onclick="explain('__EXPLAIN__')" type="button" class="btn btn-info btn-sm"><p class="fa fa-info-circle" <="" p=""></p></button>
                <button type="button" title="Execute" onclick="run()" class="btn btn-success btn-sm"><p class="fa fa-play"></p></button>
                <button type="button" title="Execute and Return Data as Variable" onclick="getData()" class="btn btn-success btn-sm"><p class="">var</p></button>
                <button id="saveDatafa0f398a-994a-4ca4-9e8a-181cff7fb08b" title="Save" class="btn btn-success btn-sm" type="button"><p class="fa fa-save" <="" p=""></p></button>
                <button id="cancelQueryfa0f398a-994a-4ca4-9e8a-181cff7fb08b" title="Cancel Query" class="btn btn-danger btn-sm disabled" type="button"><p class="fa fa-stop" <="" p=""></p></button>
            </div>
            <div id="engineButtonsfa0f398a-994a-4ca4-9e8a-181cff7fb08b" class="btn-group col-md-4"><button title="Switch Engine" onclick="switchEngines('LOCAL')" class="btn btn-warning btn-sm">LOCAL</button><button title="Switch Engine" onclick="switchEngines('RDS')" class="btn btn-warning btn-sm">RDS</button><button title="Switch Engine" onclick="switchEngines('EC2')" class="btn btn-warning btn-sm">EC2</button></div>
            <div id="tableDatafa0f398a-994a-4ca4-9e8a-181cff7fb08b"><p class="smallfont" id="dbinfofa0f398a-994a-4ca4-9e8a-181cff7fb08b">To execute: 0.027 sec | Rows: 6 | DB: sports | Host: localhost | READ MODE</p></div>
        </div>
        <div class="table" id="tablefa0f398a-994a-4ca4-9e8a-181cff7fb08b"><table class="table-striped table-hover" id="tablefa0f398a-994a-4ca4-9e8a-181cff7fb08b" width="100%"><thead><tr><th> </th><th>dateof</th><th>team</th><th>opp</th><th>pts</th><th>fg</th><th>fg_att</th><th>ft</th><th>ft_att</th><th>fg3</th><th>fg3_att</th><th>off_rebounds</th><th>def_rebounds</th><th>asst</th><th>blks</th><th>fouls</th><th>stls</th><th>turnovers</th></tr></thead><tbody><tr><td>1</td><td tabs="1" data-column="2015-11-12">2015-11-12</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="MIN">MIN</td><td tabs="1" data-column="129">129</td><td tabs="1" data-column="48">48</td><td tabs="1" data-column="89">89</td><td tabs="1" data-column="15">15</td><td tabs="1" data-column="16">16</td><td tabs="1" data-column="18">18</td><td tabs="1" data-column="38">38</td><td tabs="1" data-column="6">6</td><td tabs="1" data-column="27">27</td><td tabs="1" data-column="34">34</td><td tabs="1" data-column="7">7</td><td tabs="1" data-column="25">25</td><td tabs="1" data-column="8">8</td><td tabs="1" data-column="11">11</td></tr><tr><td>2</td><td tabs="1" data-column="2016-02-03">2016-02-03</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="WAS">WAS</td><td tabs="1" data-column="134">134</td><td tabs="1" data-column="49">49</td><td tabs="1" data-column="93">93</td><td tabs="1" data-column="16">16</td><td tabs="1" data-column="29">29</td><td tabs="1" data-column="20">20</td><td tabs="1" data-column="42">42</td><td tabs="1" data-column="11">11</td><td tabs="1" data-column="38">38</td><td tabs="1" data-column="35">35</td><td tabs="1" data-column="5">5</td><td tabs="1" data-column="24">24</td><td tabs="1" data-column="10">10</td><td tabs="1" data-column="18">18</td></tr><tr><td>3</td><td tabs="1" data-column="2016-03-21">2016-03-21</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="MIN">MIN</td><td tabs="1" data-column="109">109</td><td tabs="1" data-column="43">43</td><td tabs="1" data-column="87">87</td><td tabs="1" data-column="15">15</td><td tabs="1" data-column="24">24</td><td tabs="1" data-column="8">8</td><td tabs="1" data-column="24">24</td><td tabs="1" data-column="13">13</td><td tabs="1" data-column="31">31</td><td tabs="1" data-column="31">31</td><td tabs="1" data-column="10">10</td><td tabs="1" data-column="20">20</td><td tabs="1" data-column="13">13</td><td tabs="1" data-column="17">17</td></tr><tr><td>4</td><td tabs="1" data-column="2016-03-29">2016-03-29</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="WAS">WAS</td><td tabs="1" data-column="102">102</td><td tabs="1" data-column="38">38</td><td tabs="1" data-column="87">87</td><td tabs="1" data-column="15">15</td><td tabs="1" data-column="23">23</td><td tabs="1" data-column="11">11</td><td tabs="1" data-column="25">25</td><td tabs="1" data-column="7">7</td><td tabs="1" data-column="48">48</td><td tabs="1" data-column="27">27</td><td tabs="1" data-column="6">6</td><td tabs="1" data-column="23">23</td><td tabs="1" data-column="11">11</td><td tabs="1" data-column="16">16</td></tr><tr><td>5</td><td tabs="1" data-column="2016-04-05">2016-04-05</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="MIN">MIN</td><td tabs="1" data-column="117">117</td><td tabs="1" data-column="49">49</td><td tabs="1" data-column="98">98</td><td tabs="1" data-column="7">7</td><td tabs="1" data-column="8">8</td><td tabs="1" data-column="12">12</td><td tabs="1" data-column="35">35</td><td tabs="1" data-column="9">9</td><td tabs="1" data-column="37">37</td><td tabs="1" data-column="35">35</td><td tabs="1" data-column="5">5</td><td tabs="1" data-column="29">29</td><td tabs="1" data-column="9">9</td><td tabs="1" data-column="24">24</td></tr><tr><td>6</td><td tabs="1" data-column="2016-11-26">2016-11-26</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="MIN">MIN</td><td tabs="1" data-column="115">115</td><td tabs="1" data-column="45">45</td><td tabs="1" data-column="81">81</td><td tabs="1" data-column="14">14</td><td tabs="1" data-column="17">17</td><td tabs="1" data-column="11">11</td><td tabs="1" data-column="22">22</td><td tabs="1" data-column="12">12</td><td tabs="1" data-column="33">33</td><td tabs="1" data-column="25">25</td><td tabs="1" data-column="8">8</td><td tabs="1" data-column="14">14</td><td tabs="1" data-column="9">9</td><td tabs="1" data-column="18">18</td></tr></tbody></table></div>
        <script type="text/Javascript">




        
            var engines = JSON.parse(`{"LOCAL": {"engine": "postgresql://tdobbins:tdobbins@localhost:5432/", "caution_level": "warning", "order": 0}, "EC2": {"engine": "postgresql://tmthyjames:1q2w3e4r5t@ec2-34-204-5-97.compute-1.amazonaws.com:5432/", "caution_level": "warning", "order": 1}, "RDS": {"engine": "postgresql://tmthyjames:1q2w3e4r5t@orionpax.cvb2tnvqksy5.us-east-1.rds.amazonaws.com:5432/", "caution_level": "warning", "order": 0}}`);
            
            var sortedEngineKeys = Object.keys(engines).sort(function(a,b){
                return engines[a].order - engines[b].order;
            });
            
            var sortedEngines = sortedEngineKeys.reduce(function(output, row, idx){
                engines[row]['key'] = row;
                output.push(engines[row]);
                return output;
            }, []);
            
            var engineButtons = '';
            for (var engine in sortedEngines){
                var engineKey = sortedEngines[engine].key;
                var warningLabel = sortedEngines[engine].caution_level;
                engineButtons += '<button title="Switch Engine" onclick="switchEngines('+"'"+engineKey+"'"+')" class="btn btn-'+warningLabel+' btn-sm">'+engineKey+'</button>';
            };
            
           $("#engineButtonsfa0f398a-994a-4ca4-9e8a-181cff7fb08b").append(engineButtons);
           
           $("#cancelQueryfa0f398a-994a-4ca4-9e8a-181cff7fb08b").on('click', function(){
               if ($("#cancelQueryfa0f398a-994a-4ca4-9e8a-181cff7fb08b").hasClass('disabled')){
                   console.log('alread stopped or finished query...');
               } else {
                   cancelQuery("f8504186-07da-440f-95ab-7438f8384288");
                   //$("#cancelQueryfa0f398a-994a-4ca4-9e8a-181cff7fb08b").addClass('disabled')
               }
           });
        
            function explain(gloVar){
                var command =  `__SQLCell_GLOBAL_VARS__.`+gloVar+` = True`;
                console.log(command);
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                IPython.notebook.execute_cell();
            };
            
            function run(){
                IPython.notebook.execute_cell();
                $.get('/api/contents', function(data){
                    console.log(data);
                });
            };
            
            function cancelQuery(applicationID){
                IPython.notebook.kernel.execute('__SQLCell_GLOBAL_VARS__().kill_last_pid_on_new_thread(__SQLCell_GLOBAL_VARS__.jupyter_id, "sports", "fa0f398a-994a-4ca4-9e8a-181cff7fb08b")',
                    {
                        iopub: {
                            output: function(response) {
                                var $table = $("#tablefa0f398a-994a-4ca4-9e8a-181cff7fb08b").parent();
                                console.log(response);
                                if (response.content && response.content.text){
                                    $table.append('<h5 style="color:#d9534f;">'+response.content.text+'</h5>')
                                } else if (response.content && response.content.evalue){
                                    $table.append('<h5 style="color:#d9534f;">'+response.content.evalue+'</h5>');
                                }
                            }
                        }
                    },
                    {
                        silent: false, 
                        store_history: false, 
                        stop_on_error: true
                    }
                );
            };
            
            function getData(){
                var command = `__SQLCell_GLOBAL_VARS__.__GETDATA__ = True`;
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                IPython.notebook.execute_cell();
            };
            
            function saveData(data, filename){
                var path = $('#path').val() || './'
                var command = `__SQLCell_GLOBAL_VARS__.__SAVEDATA__, PATH = True,'`+path+`'`;
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                //IPython.notebook.execute_cell();
                
                function download(data, filename, type) {
                    var a = document.createElement("a"),
                        file = new Blob([data], {type: type});
                    if (window.navigator.msSaveOrOpenBlob) // IE10+
                        window.navigator.msSaveOrOpenBlob(file, filename);
                    else { // Others
                        var url = URL.createObjectURL(file);
                        a.href = url;
                        a.download = filename;
                        document.body.appendChild(a);
                        a.click();
                        setTimeout(function() {
                            document.body.removeChild(a);
                            window.URL.revokeObjectURL(url);  
                        }, 0); 
                    }
                }
                
                download(data, filename, 'csv');
                
            };
            
            function switchEngines(engine){
                var command = "__SQLCell_GLOBAL_VARS__.ENGINE = " + "'" + engines[engine].engine + "sports" + "'";
                var kernel = IPython.notebook.kernel;
                kernel.execute(command,{
                    iopub: {
                        output: function(response) {
                            var $table = $("#tablefa0f398a-994a-4ca4-9e8a-181cff7fb08b").parent();
                            console.log(response);
                            if (response.content && response.content.text){
                                $table.append('<h5 style="color:#d9534f;">'+response.content.text+'</h5>')
                            } else if (response.content && response.content.evalue){
                                $table.append('<h5 style="color:#d9534f;">'+response.content.evalue+'</h5>');
                            }
                        }
                    }
                },
                    {
                        silent: false, 
                        store_history: false, 
                        stop_on_error: true
                    }
                );
                IPython.notebook.execute_cell();
            };

        </script>
        </div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 28px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">You can also use the colon syntax. Some may find this cleaner and more readable.</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 58px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><p>You can also use the colon syntax. Some may find this cleaner and more readable.</p>
</div></div></div><div class="cell code_cell rendered un" tabs="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[12]:</div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 295px; margin-bottom: 0px; border-right-width: 30px; min-height: 130px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-magic">%%sql DB=sports</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> * </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">FROM</span> nba </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">WHERE</span> pts &gt; :some_int</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">AND</span> fg/fg_att::FLOAT &gt; :some_float</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">AND</span> team = :some_str</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">AND</span> opp <span class="cm-keyword">IN</span> :some_tuple</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 160px;"></div></div></div></div></div></div><div class="widget-area connection-problems" style="display: none;"><div class="prompt"><button class="close">×</button></div><div class="widget-subarea"></div></div><div class="output_wrapper"><div class=" prompt" title="click to scroll output; double click to hide" style=""></div><div class="output" style=""><div class="output_area"><div class="prompt"></div><div class="output_subarea output_html rendered_html">
        <style>
        .input { 
            position:relative; 
        }
        #childDiv06f32c6d-77c3-465d-adfe-84e2c2c28818 { 
            width: 90%;
            position:absolute; 
        }
        #table06f32c6d-77c3-465d-adfe-84e2c2c28818{
            padding-top: 60px;
        }
        .page__content p {
            margin: inherit !important;
        }
        .smallfont {
            font-size: 12px !important;
        }
        </style>
        <div class="row" id="childDiv06f32c6d-77c3-465d-adfe-84e2c2c28818">
            <div class="btn-group col-md-3">
                <button id="explain" title="Explain Analyze Graph" onclick="explain('__EXPLAIN_GRAPH__')" type="button" class="btn btn-info btn-sm"><p class="fa fa-code-fork fa-rotate-270" <="" p=""></p></button>
                <button id="explain" title="Explain Analyze" onclick="explain('__EXPLAIN__')" type="button" class="btn btn-info btn-sm"><p class="fa fa-info-circle" <="" p=""></p></button>
                <button type="button" title="Execute" onclick="run()" class="btn btn-success btn-sm"><p class="fa fa-play"></p></button>
                <button type="button" title="Execute and Return Data as Variable" onclick="getData()" class="btn btn-success btn-sm"><p class="">var</p></button>
                <button id="saveData06f32c6d-77c3-465d-adfe-84e2c2c28818" title="Save" class="btn btn-success btn-sm" type="button"><p class="fa fa-save" <="" p=""></p></button>
                <button id="cancelQuery06f32c6d-77c3-465d-adfe-84e2c2c28818" title="Cancel Query" class="btn btn-danger btn-sm disabled" type="button"><p class="fa fa-stop" <="" p=""></p></button>
            </div>
            <div id="engineButtons06f32c6d-77c3-465d-adfe-84e2c2c28818" class="btn-group col-md-4"><button title="Switch Engine" onclick="switchEngines('LOCAL')" class="btn btn-warning btn-sm">LOCAL</button><button title="Switch Engine" onclick="switchEngines('RDS')" class="btn btn-warning btn-sm">RDS</button><button title="Switch Engine" onclick="switchEngines('EC2')" class="btn btn-warning btn-sm">EC2</button></div>
            <div id="tableData06f32c6d-77c3-465d-adfe-84e2c2c28818"><p class="smallfont" id="dbinfo06f32c6d-77c3-465d-adfe-84e2c2c28818">To execute: 0.014 sec | Rows: 6 | DB: sports | Host: localhost | READ MODE</p></div>
        </div>
        <div class="table" id="table06f32c6d-77c3-465d-adfe-84e2c2c28818"><table class="table-striped table-hover" id="table06f32c6d-77c3-465d-adfe-84e2c2c28818" width="100%"><thead><tr><th> </th><th>dateof</th><th>team</th><th>opp</th><th>pts</th><th>fg</th><th>fg_att</th><th>ft</th><th>ft_att</th><th>fg3</th><th>fg3_att</th><th>off_rebounds</th><th>def_rebounds</th><th>asst</th><th>blks</th><th>fouls</th><th>stls</th><th>turnovers</th></tr></thead><tbody><tr><td>1</td><td tabs="1" data-column="2015-11-12">2015-11-12</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="MIN">MIN</td><td tabs="1" data-column="129">129</td><td tabs="1" data-column="48">48</td><td tabs="1" data-column="89">89</td><td tabs="1" data-column="15">15</td><td tabs="1" data-column="16">16</td><td tabs="1" data-column="18">18</td><td tabs="1" data-column="38">38</td><td tabs="1" data-column="6">6</td><td tabs="1" data-column="27">27</td><td tabs="1" data-column="34">34</td><td tabs="1" data-column="7">7</td><td tabs="1" data-column="25">25</td><td tabs="1" data-column="8">8</td><td tabs="1" data-column="11">11</td></tr><tr><td>2</td><td tabs="1" data-column="2016-02-03">2016-02-03</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="WAS">WAS</td><td tabs="1" data-column="134">134</td><td tabs="1" data-column="49">49</td><td tabs="1" data-column="93">93</td><td tabs="1" data-column="16">16</td><td tabs="1" data-column="29">29</td><td tabs="1" data-column="20">20</td><td tabs="1" data-column="42">42</td><td tabs="1" data-column="11">11</td><td tabs="1" data-column="38">38</td><td tabs="1" data-column="35">35</td><td tabs="1" data-column="5">5</td><td tabs="1" data-column="24">24</td><td tabs="1" data-column="10">10</td><td tabs="1" data-column="18">18</td></tr><tr><td>3</td><td tabs="1" data-column="2016-03-21">2016-03-21</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="MIN">MIN</td><td tabs="1" data-column="109">109</td><td tabs="1" data-column="43">43</td><td tabs="1" data-column="87">87</td><td tabs="1" data-column="15">15</td><td tabs="1" data-column="24">24</td><td tabs="1" data-column="8">8</td><td tabs="1" data-column="24">24</td><td tabs="1" data-column="13">13</td><td tabs="1" data-column="31">31</td><td tabs="1" data-column="31">31</td><td tabs="1" data-column="10">10</td><td tabs="1" data-column="20">20</td><td tabs="1" data-column="13">13</td><td tabs="1" data-column="17">17</td></tr><tr><td>4</td><td tabs="1" data-column="2016-03-29">2016-03-29</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="WAS">WAS</td><td tabs="1" data-column="102">102</td><td tabs="1" data-column="38">38</td><td tabs="1" data-column="87">87</td><td tabs="1" data-column="15">15</td><td tabs="1" data-column="23">23</td><td tabs="1" data-column="11">11</td><td tabs="1" data-column="25">25</td><td tabs="1" data-column="7">7</td><td tabs="1" data-column="48">48</td><td tabs="1" data-column="27">27</td><td tabs="1" data-column="6">6</td><td tabs="1" data-column="23">23</td><td tabs="1" data-column="11">11</td><td tabs="1" data-column="16">16</td></tr><tr><td>5</td><td tabs="1" data-column="2016-04-05">2016-04-05</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="MIN">MIN</td><td tabs="1" data-column="117">117</td><td tabs="1" data-column="49">49</td><td tabs="1" data-column="98">98</td><td tabs="1" data-column="7">7</td><td tabs="1" data-column="8">8</td><td tabs="1" data-column="12">12</td><td tabs="1" data-column="35">35</td><td tabs="1" data-column="9">9</td><td tabs="1" data-column="37">37</td><td tabs="1" data-column="35">35</td><td tabs="1" data-column="5">5</td><td tabs="1" data-column="29">29</td><td tabs="1" data-column="9">9</td><td tabs="1" data-column="24">24</td></tr><tr><td>6</td><td tabs="1" data-column="2016-11-26">2016-11-26</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="MIN">MIN</td><td tabs="1" data-column="115">115</td><td tabs="1" data-column="45">45</td><td tabs="1" data-column="81">81</td><td tabs="1" data-column="14">14</td><td tabs="1" data-column="17">17</td><td tabs="1" data-column="11">11</td><td tabs="1" data-column="22">22</td><td tabs="1" data-column="12">12</td><td tabs="1" data-column="33">33</td><td tabs="1" data-column="25">25</td><td tabs="1" data-column="8">8</td><td tabs="1" data-column="14">14</td><td tabs="1" data-column="9">9</td><td tabs="1" data-column="18">18</td></tr></tbody></table></div>
        <script type="text/Javascript">




        
            var engines = JSON.parse(`{"LOCAL": {"engine": "postgresql://tdobbins:tdobbins@localhost:5432/", "caution_level": "warning", "order": 0}, "EC2": {"engine": "postgresql://tmthyjames:1q2w3e4r5t@ec2-34-204-5-97.compute-1.amazonaws.com:5432/", "caution_level": "warning", "order": 1}, "RDS": {"engine": "postgresql://tmthyjames:1q2w3e4r5t@orionpax.cvb2tnvqksy5.us-east-1.rds.amazonaws.com:5432/", "caution_level": "warning", "order": 0}}`);
            
            var sortedEngineKeys = Object.keys(engines).sort(function(a,b){
                return engines[a].order - engines[b].order;
            });
            
            var sortedEngines = sortedEngineKeys.reduce(function(output, row, idx){
                engines[row]['key'] = row;
                output.push(engines[row]);
                return output;
            }, []);
            
            var engineButtons = '';
            for (var engine in sortedEngines){
                var engineKey = sortedEngines[engine].key;
                var warningLabel = sortedEngines[engine].caution_level;
                engineButtons += '<button title="Switch Engine" onclick="switchEngines('+"'"+engineKey+"'"+')" class="btn btn-'+warningLabel+' btn-sm">'+engineKey+'</button>';
            };
            
           $("#engineButtons06f32c6d-77c3-465d-adfe-84e2c2c28818").append(engineButtons);
           
           $("#cancelQuery06f32c6d-77c3-465d-adfe-84e2c2c28818").on('click', function(){
               if ($("#cancelQuery06f32c6d-77c3-465d-adfe-84e2c2c28818").hasClass('disabled')){
                   console.log('alread stopped or finished query...');
               } else {
                   cancelQuery("f8504186-07da-440f-95ab-7438f8384288");
                   //$("#cancelQuery06f32c6d-77c3-465d-adfe-84e2c2c28818").addClass('disabled')
               }
           });
        
            function explain(gloVar){
                var command =  `__SQLCell_GLOBAL_VARS__.`+gloVar+` = True`;
                console.log(command);
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                IPython.notebook.execute_cell();
            };
            
            function run(){
                IPython.notebook.execute_cell();
                $.get('/api/contents', function(data){
                    console.log(data);
                });
            };
            
            function cancelQuery(applicationID){
                IPython.notebook.kernel.execute('__SQLCell_GLOBAL_VARS__().kill_last_pid_on_new_thread(__SQLCell_GLOBAL_VARS__.jupyter_id, "sports", "06f32c6d-77c3-465d-adfe-84e2c2c28818")',
                    {
                        iopub: {
                            output: function(response) {
                                var $table = $("#table06f32c6d-77c3-465d-adfe-84e2c2c28818").parent();
                                console.log(response);
                                if (response.content && response.content.text){
                                    $table.append('<h5 style="color:#d9534f;">'+response.content.text+'</h5>')
                                } else if (response.content && response.content.evalue){
                                    $table.append('<h5 style="color:#d9534f;">'+response.content.evalue+'</h5>');
                                }
                            }
                        }
                    },
                    {
                        silent: false, 
                        store_history: false, 
                        stop_on_error: true
                    }
                );
            };
            
            function getData(){
                var command = `__SQLCell_GLOBAL_VARS__.__GETDATA__ = True`;
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                IPython.notebook.execute_cell();
            };
            
            function saveData(data, filename){
                var path = $('#path').val() || './'
                var command = `__SQLCell_GLOBAL_VARS__.__SAVEDATA__, PATH = True,'`+path+`'`;
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                //IPython.notebook.execute_cell();
                
                function download(data, filename, type) {
                    var a = document.createElement("a"),
                        file = new Blob([data], {type: type});
                    if (window.navigator.msSaveOrOpenBlob) // IE10+
                        window.navigator.msSaveOrOpenBlob(file, filename);
                    else { // Others
                        var url = URL.createObjectURL(file);
                        a.href = url;
                        a.download = filename;
                        document.body.appendChild(a);
                        a.click();
                        setTimeout(function() {
                            document.body.removeChild(a);
                            window.URL.revokeObjectURL(url);  
                        }, 0); 
                    }
                }
                
                download(data, filename, 'csv');
                
            };
            
            function switchEngines(engine){
                var command = "__SQLCell_GLOBAL_VARS__.ENGINE = " + "'" + engines[engine].engine + "sports" + "'";
                var kernel = IPython.notebook.kernel;
                kernel.execute(command,{
                    iopub: {
                        output: function(response) {
                            var $table = $("#table06f32c6d-77c3-465d-adfe-84e2c2c28818").parent();
                            console.log(response);
                            if (response.content && response.content.text){
                                $table.append('<h5 style="color:#d9534f;">'+response.content.text+'</h5>')
                            } else if (response.content && response.content.evalue){
                                $table.append('<h5 style="color:#d9534f;">'+response.content.evalue+'</h5>');
                            }
                        }
                    }
                },
                    {
                        silent: false, 
                        store_history: false, 
                        stop_on_error: true
                    }
                );
                IPython.notebook.execute_cell();
            };

        </script>
        </div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 33px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-header cm-header-2">## Pass output from SQL to Python</span></span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 63px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><h2 id="Pass-output-from-SQL-to-Python">Pass output from SQL to Python<a class="anchor-link" href="#Pass-output-from-SQL-to-Python">¶</a></h2>
</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 45px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">To return the output as a Python variable, use the <span class="cm-comment">`var`</span> button, or you can use the <span class="cm-comment">`MAKE_GLOBAL`</span> parameter. Let's do it using the parameter.</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 75px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><p>To return the output as a Python variable, use the <code>var</code> button, or you can use the <code>MAKE_GLOBAL</code> parameter. Let's do it using the parameter.</p>
</div></div></div><div class="cell code_cell rendered un" tabs="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[13]:</div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 295px; margin-bottom: 0px; border-right-width: 30px; min-height: 130px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-magic">%%sql DB=sports MAKE_GLOBAL=df</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> * </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">FROM</span> nba </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">WHERE</span> pts &gt; :some_int</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">AND</span> fg/fg_att::FLOAT &gt; :some_float</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">AND</span> team = :some_str</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">AND</span> opp <span class="cm-keyword">IN</span> :some_tuple</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 160px;"></div></div></div></div></div></div><div class="widget-area connection-problems" style="display: none;"><div class="prompt"><button class="close">×</button></div><div class="widget-subarea"></div></div><div class="output_wrapper"><div class=" prompt" title="click to scroll output; double click to hide" style=""></div><div class="output" style=""><div class="output_area"><div class="prompt"></div><div class="output_subarea output_html rendered_html">
        <style>
        .input { 
            position:relative; 
        }
        #childDive0d27c35-69b6-4a18-9a9e-2096d7f3e5e1 { 
            width: 90%;
            position:absolute; 
        }
        #tablee0d27c35-69b6-4a18-9a9e-2096d7f3e5e1{
            padding-top: 60px;
        }
        .page__content p {
            margin: inherit !important;
        }
        .smallfont {
            font-size: 12px !important;
        }
        </style>
        <div class="row" id="childDive0d27c35-69b6-4a18-9a9e-2096d7f3e5e1">
            <div class="btn-group col-md-3">
                <button id="explain" title="Explain Analyze Graph" onclick="explain('__EXPLAIN_GRAPH__')" type="button" class="btn btn-info btn-sm"><p class="fa fa-code-fork fa-rotate-270" <="" p=""></p></button>
                <button id="explain" title="Explain Analyze" onclick="explain('__EXPLAIN__')" type="button" class="btn btn-info btn-sm"><p class="fa fa-info-circle" <="" p=""></p></button>
                <button type="button" title="Execute" onclick="run()" class="btn btn-success btn-sm"><p class="fa fa-play"></p></button>
                <button type="button" title="Execute and Return Data as Variable" onclick="getData()" class="btn btn-success btn-sm"><p class="">var</p></button>
                <button id="saveDatae0d27c35-69b6-4a18-9a9e-2096d7f3e5e1" title="Save" class="btn btn-success btn-sm" type="button"><p class="fa fa-save" <="" p=""></p></button>
                <button id="cancelQuerye0d27c35-69b6-4a18-9a9e-2096d7f3e5e1" title="Cancel Query" class="btn btn-danger btn-sm disabled" type="button"><p class="fa fa-stop" <="" p=""></p></button>
            </div>
            <div id="engineButtonse0d27c35-69b6-4a18-9a9e-2096d7f3e5e1" class="btn-group col-md-4"><button title="Switch Engine" onclick="switchEngines('LOCAL')" class="btn btn-warning btn-sm">LOCAL</button><button title="Switch Engine" onclick="switchEngines('RDS')" class="btn btn-warning btn-sm">RDS</button><button title="Switch Engine" onclick="switchEngines('EC2')" class="btn btn-warning btn-sm">EC2</button></div>
            <div id="tableDatae0d27c35-69b6-4a18-9a9e-2096d7f3e5e1"><p class="smallfont" id="dbinfoe0d27c35-69b6-4a18-9a9e-2096d7f3e5e1">To execute: 0.013 sec | Rows: 6 | DB: sports | Host: localhost | READ MODE</p></div>
        </div>
        <div class="table" id="tablee0d27c35-69b6-4a18-9a9e-2096d7f3e5e1"><table class="table-striped table-hover" id="tablee0d27c35-69b6-4a18-9a9e-2096d7f3e5e1" width="100%"><thead><tr><th> </th><th>dateof</th><th>team</th><th>opp</th><th>pts</th><th>fg</th><th>fg_att</th><th>ft</th><th>ft_att</th><th>fg3</th><th>fg3_att</th><th>off_rebounds</th><th>def_rebounds</th><th>asst</th><th>blks</th><th>fouls</th><th>stls</th><th>turnovers</th></tr></thead><tbody><tr><td>1</td><td tabs="1" data-column="2015-11-12">2015-11-12</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="MIN">MIN</td><td tabs="1" data-column="129">129</td><td tabs="1" data-column="48">48</td><td tabs="1" data-column="89">89</td><td tabs="1" data-column="15">15</td><td tabs="1" data-column="16">16</td><td tabs="1" data-column="18">18</td><td tabs="1" data-column="38">38</td><td tabs="1" data-column="6">6</td><td tabs="1" data-column="27">27</td><td tabs="1" data-column="34">34</td><td tabs="1" data-column="7">7</td><td tabs="1" data-column="25">25</td><td tabs="1" data-column="8">8</td><td tabs="1" data-column="11">11</td></tr><tr><td>2</td><td tabs="1" data-column="2016-02-03">2016-02-03</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="WAS">WAS</td><td tabs="1" data-column="134">134</td><td tabs="1" data-column="49">49</td><td tabs="1" data-column="93">93</td><td tabs="1" data-column="16">16</td><td tabs="1" data-column="29">29</td><td tabs="1" data-column="20">20</td><td tabs="1" data-column="42">42</td><td tabs="1" data-column="11">11</td><td tabs="1" data-column="38">38</td><td tabs="1" data-column="35">35</td><td tabs="1" data-column="5">5</td><td tabs="1" data-column="24">24</td><td tabs="1" data-column="10">10</td><td tabs="1" data-column="18">18</td></tr><tr><td>3</td><td tabs="1" data-column="2016-03-21">2016-03-21</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="MIN">MIN</td><td tabs="1" data-column="109">109</td><td tabs="1" data-column="43">43</td><td tabs="1" data-column="87">87</td><td tabs="1" data-column="15">15</td><td tabs="1" data-column="24">24</td><td tabs="1" data-column="8">8</td><td tabs="1" data-column="24">24</td><td tabs="1" data-column="13">13</td><td tabs="1" data-column="31">31</td><td tabs="1" data-column="31">31</td><td tabs="1" data-column="10">10</td><td tabs="1" data-column="20">20</td><td tabs="1" data-column="13">13</td><td tabs="1" data-column="17">17</td></tr><tr><td>4</td><td tabs="1" data-column="2016-03-29">2016-03-29</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="WAS">WAS</td><td tabs="1" data-column="102">102</td><td tabs="1" data-column="38">38</td><td tabs="1" data-column="87">87</td><td tabs="1" data-column="15">15</td><td tabs="1" data-column="23">23</td><td tabs="1" data-column="11">11</td><td tabs="1" data-column="25">25</td><td tabs="1" data-column="7">7</td><td tabs="1" data-column="48">48</td><td tabs="1" data-column="27">27</td><td tabs="1" data-column="6">6</td><td tabs="1" data-column="23">23</td><td tabs="1" data-column="11">11</td><td tabs="1" data-column="16">16</td></tr><tr><td>5</td><td tabs="1" data-column="2016-04-05">2016-04-05</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="MIN">MIN</td><td tabs="1" data-column="117">117</td><td tabs="1" data-column="49">49</td><td tabs="1" data-column="98">98</td><td tabs="1" data-column="7">7</td><td tabs="1" data-column="8">8</td><td tabs="1" data-column="12">12</td><td tabs="1" data-column="35">35</td><td tabs="1" data-column="9">9</td><td tabs="1" data-column="37">37</td><td tabs="1" data-column="35">35</td><td tabs="1" data-column="5">5</td><td tabs="1" data-column="29">29</td><td tabs="1" data-column="9">9</td><td tabs="1" data-column="24">24</td></tr><tr><td>6</td><td tabs="1" data-column="2016-11-26">2016-11-26</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="MIN">MIN</td><td tabs="1" data-column="115">115</td><td tabs="1" data-column="45">45</td><td tabs="1" data-column="81">81</td><td tabs="1" data-column="14">14</td><td tabs="1" data-column="17">17</td><td tabs="1" data-column="11">11</td><td tabs="1" data-column="22">22</td><td tabs="1" data-column="12">12</td><td tabs="1" data-column="33">33</td><td tabs="1" data-column="25">25</td><td tabs="1" data-column="8">8</td><td tabs="1" data-column="14">14</td><td tabs="1" data-column="9">9</td><td tabs="1" data-column="18">18</td></tr></tbody></table></div>
        <script type="text/Javascript">




        
            var engines = JSON.parse(`{"LOCAL": {"engine": "postgresql://tdobbins:tdobbins@localhost:5432/", "caution_level": "warning", "order": 0}, "EC2": {"engine": "postgresql://tmthyjames:1q2w3e4r5t@ec2-34-204-5-97.compute-1.amazonaws.com:5432/", "caution_level": "warning", "order": 1}, "RDS": {"engine": "postgresql://tmthyjames:1q2w3e4r5t@orionpax.cvb2tnvqksy5.us-east-1.rds.amazonaws.com:5432/", "caution_level": "warning", "order": 0}}`);
            
            var sortedEngineKeys = Object.keys(engines).sort(function(a,b){
                return engines[a].order - engines[b].order;
            });
            
            var sortedEngines = sortedEngineKeys.reduce(function(output, row, idx){
                engines[row]['key'] = row;
                output.push(engines[row]);
                return output;
            }, []);
            
            var engineButtons = '';
            for (var engine in sortedEngines){
                var engineKey = sortedEngines[engine].key;
                var warningLabel = sortedEngines[engine].caution_level;
                engineButtons += '<button title="Switch Engine" onclick="switchEngines('+"'"+engineKey+"'"+')" class="btn btn-'+warningLabel+' btn-sm">'+engineKey+'</button>';
            };
            
           $("#engineButtonse0d27c35-69b6-4a18-9a9e-2096d7f3e5e1").append(engineButtons);
           
           $("#cancelQuerye0d27c35-69b6-4a18-9a9e-2096d7f3e5e1").on('click', function(){
               if ($("#cancelQuerye0d27c35-69b6-4a18-9a9e-2096d7f3e5e1").hasClass('disabled')){
                   console.log('alread stopped or finished query...');
               } else {
                   cancelQuery("f8504186-07da-440f-95ab-7438f8384288");
                   //$("#cancelQuerye0d27c35-69b6-4a18-9a9e-2096d7f3e5e1").addClass('disabled')
               }
           });
        
            function explain(gloVar){
                var command =  `__SQLCell_GLOBAL_VARS__.`+gloVar+` = True`;
                console.log(command);
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                IPython.notebook.execute_cell();
            };
            
            function run(){
                IPython.notebook.execute_cell();
                $.get('/api/contents', function(data){
                    console.log(data);
                });
            };
            
            function cancelQuery(applicationID){
                IPython.notebook.kernel.execute('__SQLCell_GLOBAL_VARS__().kill_last_pid_on_new_thread(__SQLCell_GLOBAL_VARS__.jupyter_id, "sports", "e0d27c35-69b6-4a18-9a9e-2096d7f3e5e1")',
                    {
                        iopub: {
                            output: function(response) {
                                var $table = $("#tablee0d27c35-69b6-4a18-9a9e-2096d7f3e5e1").parent();
                                console.log(response);
                                if (response.content && response.content.text){
                                    $table.append('<h5 style="color:#d9534f;">'+response.content.text+'</h5>')
                                } else if (response.content && response.content.evalue){
                                    $table.append('<h5 style="color:#d9534f;">'+response.content.evalue+'</h5>');
                                }
                            }
                        }
                    },
                    {
                        silent: false, 
                        store_history: false, 
                        stop_on_error: true
                    }
                );
            };
            
            function getData(){
                var command = `__SQLCell_GLOBAL_VARS__.__GETDATA__ = True`;
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                IPython.notebook.execute_cell();
            };
            
            function saveData(data, filename){
                var path = $('#path').val() || './'
                var command = `__SQLCell_GLOBAL_VARS__.__SAVEDATA__, PATH = True,'`+path+`'`;
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                //IPython.notebook.execute_cell();
                
                function download(data, filename, type) {
                    var a = document.createElement("a"),
                        file = new Blob([data], {type: type});
                    if (window.navigator.msSaveOrOpenBlob) // IE10+
                        window.navigator.msSaveOrOpenBlob(file, filename);
                    else { // Others
                        var url = URL.createObjectURL(file);
                        a.href = url;
                        a.download = filename;
                        document.body.appendChild(a);
                        a.click();
                        setTimeout(function() {
                            document.body.removeChild(a);
                            window.URL.revokeObjectURL(url);  
                        }, 0); 
                    }
                }
                
                download(data, filename, 'csv');
                
            };
            
            function switchEngines(engine){
                var command = "__SQLCell_GLOBAL_VARS__.ENGINE = " + "'" + engines[engine].engine + "sports" + "'";
                var kernel = IPython.notebook.kernel;
                kernel.execute(command,{
                    iopub: {
                        output: function(response) {
                            var $table = $("#tablee0d27c35-69b6-4a18-9a9e-2096d7f3e5e1").parent();
                            console.log(response);
                            if (response.content && response.content.text){
                                $table.append('<h5 style="color:#d9534f;">'+response.content.text+'</h5>')
                            } else if (response.content && response.content.evalue){
                                $table.append('<h5 style="color:#d9534f;">'+response.content.evalue+'</h5>');
                            }
                        }
                    }
                },
                    {
                        silent: false, 
                        store_history: false, 
                        stop_on_error: true
                    }
                );
                IPython.notebook.execute_cell();
            };

        </script>
        </div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 28px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">Now, <span class="cm-comment">`df`</span> contains the dataframe that gets returned from the query.</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 58px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><p>Now, <code>df</code> contains the dataframe that gets returned from the query.</p>
</div></div></div><div class="cell code_cell rendered un" tabs="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[14]:</div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 18px; margin-bottom: 0px; border-right-width: 30px; min-height: 28px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable cm-cm-overlay cm-matchhighlight">df</span></span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 58px;"></div></div></div></div></div></div><div class="widget-area connection-problems" style="display: none;"><div class="prompt"><button class="close">×</button></div><div class="widget-subarea"></div></div><div class="output_wrapper"><div class=" prompt" title="click to scroll output; double click to hide" style=""></div><div class="output" style=""><div class="output_area"><div class="prompt output_prompt">Out[14]:</div><div class="output_subarea output_html rendered_html output_result"><div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dateof</th>
      <th>team</th>
      <th>opp</th>
      <th>pts</th>
      <th>fg</th>
      <th>fg_att</th>
      <th>ft</th>
      <th>ft_att</th>
      <th>fg3</th>
      <th>fg3_att</th>
      <th>off_rebounds</th>
      <th>def_rebounds</th>
      <th>asst</th>
      <th>blks</th>
      <th>fouls</th>
      <th>stls</th>
      <th>turnovers</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-11-12</td>
      <td>GS</td>
      <td>MIN</td>
      <td>129</td>
      <td>48</td>
      <td>89</td>
      <td>15</td>
      <td>16</td>
      <td>18</td>
      <td>38</td>
      <td>6</td>
      <td>27</td>
      <td>34</td>
      <td>7</td>
      <td>25</td>
      <td>8</td>
      <td>11</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2016-02-03</td>
      <td>GS</td>
      <td>WAS</td>
      <td>134</td>
      <td>49</td>
      <td>93</td>
      <td>16</td>
      <td>29</td>
      <td>20</td>
      <td>42</td>
      <td>11</td>
      <td>38</td>
      <td>35</td>
      <td>5</td>
      <td>24</td>
      <td>10</td>
      <td>18</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2016-03-21</td>
      <td>GS</td>
      <td>MIN</td>
      <td>109</td>
      <td>43</td>
      <td>87</td>
      <td>15</td>
      <td>24</td>
      <td>8</td>
      <td>24</td>
      <td>13</td>
      <td>31</td>
      <td>31</td>
      <td>10</td>
      <td>20</td>
      <td>13</td>
      <td>17</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2016-03-29</td>
      <td>GS</td>
      <td>WAS</td>
      <td>102</td>
      <td>38</td>
      <td>87</td>
      <td>15</td>
      <td>23</td>
      <td>11</td>
      <td>25</td>
      <td>7</td>
      <td>48</td>
      <td>27</td>
      <td>6</td>
      <td>23</td>
      <td>11</td>
      <td>16</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2016-04-05</td>
      <td>GS</td>
      <td>MIN</td>
      <td>117</td>
      <td>49</td>
      <td>98</td>
      <td>7</td>
      <td>8</td>
      <td>12</td>
      <td>35</td>
      <td>9</td>
      <td>37</td>
      <td>35</td>
      <td>5</td>
      <td>29</td>
      <td>9</td>
      <td>24</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2016-11-26</td>
      <td>GS</td>
      <td>MIN</td>
      <td>115</td>
      <td>45</td>
      <td>81</td>
      <td>14</td>
      <td>17</td>
      <td>11</td>
      <td>22</td>
      <td>12</td>
      <td>33</td>
      <td>25</td>
      <td>8</td>
      <td>14</td>
      <td>9</td>
      <td>18</td>
    </tr>
  </tbody>
</table>
</div></div></div></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 45px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">You can also pass the output of the query to python as the raw result set using the <span class="cm-comment">`RAW`</span> parameter.</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 75px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><p>You can also pass the output of the query to python as the raw result set using the <code>RAW</code> parameter.</p>
</div></div></div><div class="cell code_cell rendered un" tabs="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[15]:</div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 303px; margin-bottom: 0px; border-right-width: 30px; min-height: 130px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-magic">%%sql DB=sports MAKE_GLOBAL=df RAW=True</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> * </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">FROM</span> nba </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">WHERE</span> pts &gt; :some_int</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">AND</span> fg/fg_att::FLOAT &gt; :some_float</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">AND</span> team = :some_str</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">AND</span> opp <span class="cm-keyword">IN</span> :some_tuple</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 160px;"></div></div></div></div></div></div><div class="widget-area connection-problems" style="display: none;"><div class="prompt"><button class="close">×</button></div><div class="widget-subarea"></div></div><div class="output_wrapper"><div class=" prompt" title="click to scroll output; double click to hide" style=""></div><div class="output" style=""><div class="output_area"><div class="prompt"></div><div class="output_subarea output_html rendered_html">
        <style>
        .input { 
            position:relative; 
        }
        #childDivff6e324e-787d-4966-a576-88292db8b62c { 
            width: 90%;
            position:absolute; 
        }
        #tableff6e324e-787d-4966-a576-88292db8b62c{
            padding-top: 60px;
        }
        .page__content p {
            margin: inherit !important;
        }
        .smallfont {
            font-size: 12px !important;
        }
        </style>
        <div class="row" id="childDivff6e324e-787d-4966-a576-88292db8b62c">
            <div class="btn-group col-md-3">
                <button id="explain" title="Explain Analyze Graph" onclick="explain('__EXPLAIN_GRAPH__')" type="button" class="btn btn-info btn-sm"><p class="fa fa-code-fork fa-rotate-270" <="" p=""></p></button>
                <button id="explain" title="Explain Analyze" onclick="explain('__EXPLAIN__')" type="button" class="btn btn-info btn-sm"><p class="fa fa-info-circle" <="" p=""></p></button>
                <button type="button" title="Execute" onclick="run()" class="btn btn-success btn-sm"><p class="fa fa-play"></p></button>
                <button type="button" title="Execute and Return Data as Variable" onclick="getData()" class="btn btn-success btn-sm"><p class="">var</p></button>
                <button id="saveDataff6e324e-787d-4966-a576-88292db8b62c" title="Save" class="btn btn-success btn-sm" type="button"><p class="fa fa-save" <="" p=""></p></button>
                <button id="cancelQueryff6e324e-787d-4966-a576-88292db8b62c" title="Cancel Query" class="btn btn-danger btn-sm disabled" type="button"><p class="fa fa-stop" <="" p=""></p></button>
            </div>
            <div id="engineButtonsff6e324e-787d-4966-a576-88292db8b62c" class="btn-group col-md-4"><button title="Switch Engine" onclick="switchEngines('LOCAL')" class="btn btn-warning btn-sm">LOCAL</button><button title="Switch Engine" onclick="switchEngines('RDS')" class="btn btn-warning btn-sm">RDS</button><button title="Switch Engine" onclick="switchEngines('EC2')" class="btn btn-warning btn-sm">EC2</button></div>
            <div id="tableDataff6e324e-787d-4966-a576-88292db8b62c"><p class="smallfont" id="dbinfoff6e324e-787d-4966-a576-88292db8b62c">To execute: 0.014 sec | Rows: 6 | DB: sports | Host: localhost | READ MODE</p></div>
        </div>
        <div class="table" id="tableff6e324e-787d-4966-a576-88292db8b62c"><table class="table-striped table-hover" id="tableff6e324e-787d-4966-a576-88292db8b62c" width="100%"><thead><tr><th> </th><th>dateof</th><th>team</th><th>opp</th><th>pts</th><th>fg</th><th>fg_att</th><th>ft</th><th>ft_att</th><th>fg3</th><th>fg3_att</th><th>off_rebounds</th><th>def_rebounds</th><th>asst</th><th>blks</th><th>fouls</th><th>stls</th><th>turnovers</th></tr></thead><tbody><tr><td>1</td><td tabs="1" data-column="2015-11-12">2015-11-12</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="MIN">MIN</td><td tabs="1" data-column="129">129</td><td tabs="1" data-column="48">48</td><td tabs="1" data-column="89">89</td><td tabs="1" data-column="15">15</td><td tabs="1" data-column="16">16</td><td tabs="1" data-column="18">18</td><td tabs="1" data-column="38">38</td><td tabs="1" data-column="6">6</td><td tabs="1" data-column="27">27</td><td tabs="1" data-column="34">34</td><td tabs="1" data-column="7">7</td><td tabs="1" data-column="25">25</td><td tabs="1" data-column="8">8</td><td tabs="1" data-column="11">11</td></tr><tr><td>2</td><td tabs="1" data-column="2016-02-03">2016-02-03</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="WAS">WAS</td><td tabs="1" data-column="134">134</td><td tabs="1" data-column="49">49</td><td tabs="1" data-column="93">93</td><td tabs="1" data-column="16">16</td><td tabs="1" data-column="29">29</td><td tabs="1" data-column="20">20</td><td tabs="1" data-column="42">42</td><td tabs="1" data-column="11">11</td><td tabs="1" data-column="38">38</td><td tabs="1" data-column="35">35</td><td tabs="1" data-column="5">5</td><td tabs="1" data-column="24">24</td><td tabs="1" data-column="10">10</td><td tabs="1" data-column="18">18</td></tr><tr><td>3</td><td tabs="1" data-column="2016-03-21">2016-03-21</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="MIN">MIN</td><td tabs="1" data-column="109">109</td><td tabs="1" data-column="43">43</td><td tabs="1" data-column="87">87</td><td tabs="1" data-column="15">15</td><td tabs="1" data-column="24">24</td><td tabs="1" data-column="8">8</td><td tabs="1" data-column="24">24</td><td tabs="1" data-column="13">13</td><td tabs="1" data-column="31">31</td><td tabs="1" data-column="31">31</td><td tabs="1" data-column="10">10</td><td tabs="1" data-column="20">20</td><td tabs="1" data-column="13">13</td><td tabs="1" data-column="17">17</td></tr><tr><td>4</td><td tabs="1" data-column="2016-03-29">2016-03-29</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="WAS">WAS</td><td tabs="1" data-column="102">102</td><td tabs="1" data-column="38">38</td><td tabs="1" data-column="87">87</td><td tabs="1" data-column="15">15</td><td tabs="1" data-column="23">23</td><td tabs="1" data-column="11">11</td><td tabs="1" data-column="25">25</td><td tabs="1" data-column="7">7</td><td tabs="1" data-column="48">48</td><td tabs="1" data-column="27">27</td><td tabs="1" data-column="6">6</td><td tabs="1" data-column="23">23</td><td tabs="1" data-column="11">11</td><td tabs="1" data-column="16">16</td></tr><tr><td>5</td><td tabs="1" data-column="2016-04-05">2016-04-05</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="MIN">MIN</td><td tabs="1" data-column="117">117</td><td tabs="1" data-column="49">49</td><td tabs="1" data-column="98">98</td><td tabs="1" data-column="7">7</td><td tabs="1" data-column="8">8</td><td tabs="1" data-column="12">12</td><td tabs="1" data-column="35">35</td><td tabs="1" data-column="9">9</td><td tabs="1" data-column="37">37</td><td tabs="1" data-column="35">35</td><td tabs="1" data-column="5">5</td><td tabs="1" data-column="29">29</td><td tabs="1" data-column="9">9</td><td tabs="1" data-column="24">24</td></tr><tr><td>6</td><td tabs="1" data-column="2016-11-26">2016-11-26</td><td tabs="1" data-column="GS">GS</td><td tabs="1" data-column="MIN">MIN</td><td tabs="1" data-column="115">115</td><td tabs="1" data-column="45">45</td><td tabs="1" data-column="81">81</td><td tabs="1" data-column="14">14</td><td tabs="1" data-column="17">17</td><td tabs="1" data-column="11">11</td><td tabs="1" data-column="22">22</td><td tabs="1" data-column="12">12</td><td tabs="1" data-column="33">33</td><td tabs="1" data-column="25">25</td><td tabs="1" data-column="8">8</td><td tabs="1" data-column="14">14</td><td tabs="1" data-column="9">9</td><td tabs="1" data-column="18">18</td></tr></tbody></table></div>
        <script type="text/Javascript">




        
            var engines = JSON.parse(`{"LOCAL": {"engine": "postgresql://tdobbins:tdobbins@localhost:5432/", "caution_level": "warning", "order": 0}, "EC2": {"engine": "postgresql://tmthyjames:1q2w3e4r5t@ec2-34-204-5-97.compute-1.amazonaws.com:5432/", "caution_level": "warning", "order": 1}, "RDS": {"engine": "postgresql://tmthyjames:1q2w3e4r5t@orionpax.cvb2tnvqksy5.us-east-1.rds.amazonaws.com:5432/", "caution_level": "warning", "order": 0}}`);
            
            var sortedEngineKeys = Object.keys(engines).sort(function(a,b){
                return engines[a].order - engines[b].order;
            });
            
            var sortedEngines = sortedEngineKeys.reduce(function(output, row, idx){
                engines[row]['key'] = row;
                output.push(engines[row]);
                return output;
            }, []);
            
            var engineButtons = '';
            for (var engine in sortedEngines){
                var engineKey = sortedEngines[engine].key;
                var warningLabel = sortedEngines[engine].caution_level;
                engineButtons += '<button title="Switch Engine" onclick="switchEngines('+"'"+engineKey+"'"+')" class="btn btn-'+warningLabel+' btn-sm">'+engineKey+'</button>';
            };
            
           $("#engineButtonsff6e324e-787d-4966-a576-88292db8b62c").append(engineButtons);
           
           $("#cancelQueryff6e324e-787d-4966-a576-88292db8b62c").on('click', function(){
               if ($("#cancelQueryff6e324e-787d-4966-a576-88292db8b62c").hasClass('disabled')){
                   console.log('alread stopped or finished query...');
               } else {
                   cancelQuery("f8504186-07da-440f-95ab-7438f8384288");
                   //$("#cancelQueryff6e324e-787d-4966-a576-88292db8b62c").addClass('disabled')
               }
           });
        
            function explain(gloVar){
                var command =  `__SQLCell_GLOBAL_VARS__.`+gloVar+` = True`;
                console.log(command);
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                IPython.notebook.execute_cell();
            };
            
            function run(){
                IPython.notebook.execute_cell();
                $.get('/api/contents', function(data){
                    console.log(data);
                });
            };
            
            function cancelQuery(applicationID){
                IPython.notebook.kernel.execute('__SQLCell_GLOBAL_VARS__().kill_last_pid_on_new_thread(__SQLCell_GLOBAL_VARS__.jupyter_id, "sports", "ff6e324e-787d-4966-a576-88292db8b62c")',
                    {
                        iopub: {
                            output: function(response) {
                                var $table = $("#tableff6e324e-787d-4966-a576-88292db8b62c").parent();
                                console.log(response);
                                if (response.content && response.content.text){
                                    $table.append('<h5 style="color:#d9534f;">'+response.content.text+'</h5>')
                                } else if (response.content && response.content.evalue){
                                    $table.append('<h5 style="color:#d9534f;">'+response.content.evalue+'</h5>');
                                }
                            }
                        }
                    },
                    {
                        silent: false, 
                        store_history: false, 
                        stop_on_error: true
                    }
                );
            };
            
            function getData(){
                var command = `__SQLCell_GLOBAL_VARS__.__GETDATA__ = True`;
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                IPython.notebook.execute_cell();
            };
            
            function saveData(data, filename){
                var path = $('#path').val() || './'
                var command = `__SQLCell_GLOBAL_VARS__.__SAVEDATA__, PATH = True,'`+path+`'`;
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                //IPython.notebook.execute_cell();
                
                function download(data, filename, type) {
                    var a = document.createElement("a"),
                        file = new Blob([data], {type: type});
                    if (window.navigator.msSaveOrOpenBlob) // IE10+
                        window.navigator.msSaveOrOpenBlob(file, filename);
                    else { // Others
                        var url = URL.createObjectURL(file);
                        a.href = url;
                        a.download = filename;
                        document.body.appendChild(a);
                        a.click();
                        setTimeout(function() {
                            document.body.removeChild(a);
                            window.URL.revokeObjectURL(url);  
                        }, 0); 
                    }
                }
                
                download(data, filename, 'csv');
                
            };
            
            function switchEngines(engine){
                var command = "__SQLCell_GLOBAL_VARS__.ENGINE = " + "'" + engines[engine].engine + "sports" + "'";
                var kernel = IPython.notebook.kernel;
                kernel.execute(command,{
                    iopub: {
                        output: function(response) {
                            var $table = $("#tableff6e324e-787d-4966-a576-88292db8b62c").parent();
                            console.log(response);
                            if (response.content && response.content.text){
                                $table.append('<h5 style="color:#d9534f;">'+response.content.text+'</h5>')
                            } else if (response.content && response.content.evalue){
                                $table.append('<h5 style="color:#d9534f;">'+response.content.evalue+'</h5>');
                            }
                        }
                    }
                },
                    {
                        silent: false, 
                        store_history: false, 
                        stop_on_error: true
                    }
                );
                IPython.notebook.execute_cell();
            };

        </script>
        </div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 28px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">Now, <span class="cm-comment">`df`</span> is the raw result set returned by SQLAlchemy.</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 58px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><p>Now, <code>df</code> is the raw result set returned by SQLAlchemy.</p>
</div></div></div><div class="cell code_cell rendered un" tabs="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[16]:</div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 18px; margin-bottom: 0px; border-right-width: 30px; min-height: 28px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable cm-cm-overlay cm-matchhighlight">df</span></span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 58px;"></div></div></div></div></div></div><div class="widget-area connection-problems" style="display: none;"><div class="prompt"><button class="close">×</button></div><div class="widget-subarea"></div></div><div class="output_wrapper"><div class=" prompt" title="click to scroll output; double click to hide" style=""></div><div class="output" style=""><div class="output_area"><div class="prompt output_prompt">Out[16]:</div><div class="output_subarea output_text output_result"><pre>[(datetime.date(2015, 11, 12), u'GS', u'MIN', 129L, 48, 89, 15, 16, 18, 38, 6, 27, 34, 7, 25, 8, 11),
 (datetime.date(2016, 2, 3), u'GS', u'WAS', 134L, 49, 93, 16, 29, 20, 42, 11, 38, 35, 5, 24, 10, 18),
 (datetime.date(2016, 3, 21), u'GS', u'MIN', 109L, 43, 87, 15, 24, 8, 24, 13, 31, 31, 10, 20, 13, 17),
 (datetime.date(2016, 3, 29), u'GS', u'WAS', 102L, 38, 87, 15, 23, 11, 25, 7, 48, 27, 6, 23, 11, 16),
 (datetime.date(2016, 4, 5), u'GS', u'MIN', 117L, 49, 98, 7, 8, 12, 35, 9, 37, 35, 5, 29, 9, 24),
 (datetime.date(2016, 11, 26), u'GS', u'MIN', 115L, 45, 81, 14, 17, 11, 22, 12, 33, 25, 8, 14, 9, 18)]</pre></div></div></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 33px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-header cm-header-2">## Query plan as color coded table or graph</span></span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 63px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><h2 id="Query-plan-as-color-coded-table-or-graph">Query plan as color coded table or graph<a class="anchor-link" href="#Query-plan-as-color-coded-table-or-graph">¶</a></h2>
</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 45px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">This feature helps to point out slow spots in your queries. First let's look at the query plan table. At the moment, it only works with PostgreSQL.</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 75px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><p>This feature helps to point out slow spots in your queries. First let's look at the query plan table. At the moment, it only works with PostgreSQL.</p>
</div></div></div><div class="cell code_cell rendered un" tabs="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[19]:</div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 124.594px; left: 359.594px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 357px; margin-bottom: 0px; border-right-width: 30px; min-height: 147px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors" style="visibility: hidden;"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-magic">%%sql DB=econ</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">select</span> average_family_size,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    average_home_value,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    average_household_income,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    average_household_size,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    county</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">from</span> block_data bd</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">join</span> block_shapes bs <span class="cm-keyword">on</span> bs<span class="cm-variable-2">.id</span> = bd<span class="cm-variable-2">.block_code</span> </span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 177px;"></div></div></div></div></div></div><div class="widget-area connection-problems" style="display: none;"><div class="prompt"><button class="close">×</button></div><div class="widget-subarea"></div></div><div class="output_wrapper"><div class=" prompt" title="click to scroll output; double click to hide" style=""></div><div class="output" style=""><div class="output_area"><div class="prompt"></div><div class="output_subarea output_html rendered_html">
        <style>
        .input { 
            position:relative; 
        }
        #childDiv79cc30b6-1d75-43d7-89d1-d9af92553ca3 { 
            width: 90%;
            position:absolute; 
        }
        #table79cc30b6-1d75-43d7-89d1-d9af92553ca3{
            padding-top: 60px;
        }
        .page__content p {
            margin: inherit !important;
        }
        .smallfont {
            font-size: 12px !important;
        }
        </style>
        <div class="row" id="childDiv79cc30b6-1d75-43d7-89d1-d9af92553ca3">
            <div class="btn-group col-md-3">
                <button id="explain" title="Explain Analyze Graph" onclick="explain('__EXPLAIN_GRAPH__')" type="button" class="btn btn-info btn-sm"><p class="fa fa-code-fork fa-rotate-270" <="" p=""></p></button>
                <button id="explain" title="Explain Analyze" onclick="explain('__EXPLAIN__')" type="button" class="btn btn-info btn-sm"><p class="fa fa-info-circle" <="" p=""></p></button>
                <button type="button" title="Execute" onclick="run()" class="btn btn-success btn-sm"><p class="fa fa-play"></p></button>
                <button type="button" title="Execute and Return Data as Variable" onclick="getData()" class="btn btn-success btn-sm"><p class="">var</p></button>
                <button id="saveData79cc30b6-1d75-43d7-89d1-d9af92553ca3" title="Save" class="btn btn-success btn-sm" type="button"><p class="fa fa-save" <="" p=""></p></button>
                <button id="cancelQuery79cc30b6-1d75-43d7-89d1-d9af92553ca3" title="Cancel Query" class="btn btn-danger btn-sm disabled" type="button"><p class="fa fa-stop" <="" p=""></p></button>
            </div>
            <div id="engineButtons79cc30b6-1d75-43d7-89d1-d9af92553ca3" class="btn-group col-md-4"><button title="Switch Engine" onclick="switchEngines('LOCAL')" class="btn btn-warning btn-sm">LOCAL</button><button title="Switch Engine" onclick="switchEngines('RDS')" class="btn btn-warning btn-sm">RDS</button><button title="Switch Engine" onclick="switchEngines('EC2')" class="btn btn-warning btn-sm">EC2</button></div>
            <div id="tableData79cc30b6-1d75-43d7-89d1-d9af92553ca3"><p class="smallfont" id="dbinfo79cc30b6-1d75-43d7-89d1-d9af92553ca3">To execute: 0.011 sec | Rows: 8 | DB: econ | Host: localhost | READ MODE</p></div>
        </div>
        <div class="table" id="table79cc30b6-1d75-43d7-89d1-d9af92553ca3"><table class="table-striped table-hover" id="table79cc30b6-1d75-43d7-89d1-d9af92553ca3" width="100%"><thead><tr><th> </th><th>QUERY PLAN</th></tr></thead><tbody><tr><td>1</td><td>Hash Join&nbsp;&nbsp;&nbsp;(cost=33.60..89.81 rows=472 width=48) (<b style="background-color:#feb24c;">actual time</b>=0.499..0.977 rows=472 loops=1)</td></tr><tr><td>2</td><td>&nbsp;&nbsp;&nbsp;Hash Cond: (bs.id = bd.block_code)</td></tr><tr><td>3</td><td>&nbsp;&nbsp;&nbsp;-&gt;&nbsp;&nbsp;&nbsp;Seq Scan on block_shapes bs&nbsp;&nbsp;&nbsp;(cost=0.00..49.72 rows=472 width=8) (<b style="background-color:#ffffcc;">actual time</b>=0.007..0.182 rows=472 loops=1)</td></tr><tr><td>4</td><td>&nbsp;&nbsp;&nbsp;-&gt;&nbsp;&nbsp;&nbsp;Hash&nbsp;&nbsp;&nbsp;(cost=27.71..27.71 rows=471 width=56) (<b style="background-color:;">actual time</b>=0.470..0.470 rows=471 loops=1)</td></tr><tr><td>5</td><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Buckets: 1024&nbsp;&nbsp;&nbsp;Batches: 1&nbsp;&nbsp;&nbsp;Memory Usage: 49kB</td></tr><tr><td>6</td><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;&nbsp;&nbsp;Seq Scan on block_data bd&nbsp;&nbsp;&nbsp;(cost=0.00..27.71 rows=471 width=56) (<b style="background-color:#fed976;">actual time</b>=0.008..0.352 rows=471 loops=1)</td></tr><tr><td>7</td><td>Planning time: 0.192 ms</td></tr><tr><td>8</td><td>Execution time: 1.054 ms</td></tr></tbody></table></div>
        <script type="text/Javascript">




        
            var engines = JSON.parse(`{"LOCAL": {"engine": "postgresql://tdobbins:tdobbins@localhost:5432/", "caution_level": "warning", "order": 0}, "EC2": {"engine": "postgresql://tmthyjames:1q2w3e4r5t@ec2-34-204-5-97.compute-1.amazonaws.com:5432/", "caution_level": "warning", "order": 1}, "RDS": {"engine": "postgresql://tmthyjames:1q2w3e4r5t@orionpax.cvb2tnvqksy5.us-east-1.rds.amazonaws.com:5432/", "caution_level": "warning", "order": 0}}`);
            
            var sortedEngineKeys = Object.keys(engines).sort(function(a,b){
                return engines[a].order - engines[b].order;
            });
            
            var sortedEngines = sortedEngineKeys.reduce(function(output, row, idx){
                engines[row]['key'] = row;
                output.push(engines[row]);
                return output;
            }, []);
            
            var engineButtons = '';
            for (var engine in sortedEngines){
                var engineKey = sortedEngines[engine].key;
                var warningLabel = sortedEngines[engine].caution_level;
                engineButtons += '<button title="Switch Engine" onclick="switchEngines('+"'"+engineKey+"'"+')" class="btn btn-'+warningLabel+' btn-sm">'+engineKey+'</button>';
            };
            
           $("#engineButtons79cc30b6-1d75-43d7-89d1-d9af92553ca3").append(engineButtons);
           
           $("#cancelQuery79cc30b6-1d75-43d7-89d1-d9af92553ca3").on('click', function(){
               if ($("#cancelQuery79cc30b6-1d75-43d7-89d1-d9af92553ca3").hasClass('disabled')){
                   console.log('alread stopped or finished query...');
               } else {
                   cancelQuery("f8504186-07da-440f-95ab-7438f8384288");
                   //$("#cancelQuery79cc30b6-1d75-43d7-89d1-d9af92553ca3").addClass('disabled')
               }
           });
        
            function explain(gloVar){
                var command =  `__SQLCell_GLOBAL_VARS__.`+gloVar+` = True`;
                console.log(command);
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                IPython.notebook.execute_cell();
            };
            
            function run(){
                IPython.notebook.execute_cell();
                $.get('/api/contents', function(data){
                    console.log(data);
                });
            };
            
            function cancelQuery(applicationID){
                IPython.notebook.kernel.execute('__SQLCell_GLOBAL_VARS__().kill_last_pid_on_new_thread(__SQLCell_GLOBAL_VARS__.jupyter_id, "econ", "79cc30b6-1d75-43d7-89d1-d9af92553ca3")',
                    {
                        iopub: {
                            output: function(response) {
                                var $table = $("#table79cc30b6-1d75-43d7-89d1-d9af92553ca3").parent();
                                console.log(response);
                                if (response.content && response.content.text){
                                    $table.append('<h5 style="color:#d9534f;">'+response.content.text+'</h5>')
                                } else if (response.content && response.content.evalue){
                                    $table.append('<h5 style="color:#d9534f;">'+response.content.evalue+'</h5>');
                                }
                            }
                        }
                    },
                    {
                        silent: false, 
                        store_history: false, 
                        stop_on_error: true
                    }
                );
            };
            
            function getData(){
                var command = `__SQLCell_GLOBAL_VARS__.__GETDATA__ = True`;
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                IPython.notebook.execute_cell();
            };
            
            function saveData(data, filename){
                var path = $('#path').val() || './'
                var command = `__SQLCell_GLOBAL_VARS__.__SAVEDATA__, PATH = True,'`+path+`'`;
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                //IPython.notebook.execute_cell();
                
                function download(data, filename, type) {
                    var a = document.createElement("a"),
                        file = new Blob([data], {type: type});
                    if (window.navigator.msSaveOrOpenBlob) // IE10+
                        window.navigator.msSaveOrOpenBlob(file, filename);
                    else { // Others
                        var url = URL.createObjectURL(file);
                        a.href = url;
                        a.download = filename;
                        document.body.appendChild(a);
                        a.click();
                        setTimeout(function() {
                            document.body.removeChild(a);
                            window.URL.revokeObjectURL(url);  
                        }, 0); 
                    }
                }
                
                download(data, filename, 'csv');
                
            };
            
            function switchEngines(engine){
                var command = "__SQLCell_GLOBAL_VARS__.ENGINE = " + "'" + engines[engine].engine + "econ" + "'";
                var kernel = IPython.notebook.kernel;
                kernel.execute(command,{
                    iopub: {
                        output: function(response) {
                            var $table = $("#table79cc30b6-1d75-43d7-89d1-d9af92553ca3").parent();
                            console.log(response);
                            if (response.content && response.content.text){
                                $table.append('<h5 style="color:#d9534f;">'+response.content.text+'</h5>')
                            } else if (response.content && response.content.evalue){
                                $table.append('<h5 style="color:#d9534f;">'+response.content.evalue+'</h5>');
                            }
                        }
                    }
                },
                    {
                        silent: false, 
                        store_history: false, 
                        stop_on_error: true
                    }
                );
                IPython.notebook.execute_cell();
            };

        </script>
        </div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 79px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">The darker the color, the slower the node. Here, we can see that most of the time was used by a hash join that returned 472 rows. Let's look at the query plan graph, built with d3.js. It's a sankey graph that shows the hierarchy of the nodes and their respective cost in terms of tie and rows.</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 109px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><p>The darker the color, the slower the node. Here, we can see that most of the time was used by a hash join that returned 472 rows. Let's look at the query plan graph, built with d3.js. It's a sankey graph that shows the hierarchy of the nodes and their respective cost in terms of tie and rows.</p>
</div></div></div><div class="cell code_cell rendered un" tabs="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[3]:</div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 974.594px; left: 205.594px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="width: 18px; pointer-events: none; bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 780px; margin-bottom: 0px; border-right-width: 30px; min-height: 1048px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-magic">%%sql DB=econ</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> *, </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    CASE </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        WHEN num_of_sb &gt; <span class="cm-number">0</span> THEN <span class="cm-atom">true</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        ELSE <span class="cm-atom">false</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    end <span class="cm-keyword">AS</span> has_starbucks</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">FROM</span> (</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">SELECT</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        ST_Area(geom::geography) / <span class="cm-number">1609.34</span>^2 <span class="cm-keyword">AS</span> sq_miles,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-string">"HC03_VC96"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-string">"HC01_VC03"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-string">"HC01_VC103"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-string">"HC03_VC67"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-string">"HC03_VC68"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-string">"HC03_VC88"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-string">"HC03_VC49"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-string">"HC01_VC88"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-string">"HC03_VC135"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-string">"HC03_VC136"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-string">"HC03_VC92"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        z.<span class="cm-string">"HC03_VC12"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        z.<span class="cm-string">"HC03_VC41"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-string">"HC03_VC43"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-string">"HC03_VC161"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-string">"HC01_VC118"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-string">"HC03_VC87"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        z.<span class="cm-string">"HC03_VC171"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        zn.*,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        z<span class="cm-variable-2">.starbucks_count</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        sqrt(<span class="cm-string">"HC01_VC03"</span>) <span class="cm-keyword">as</span> <span class="cm-string">"HC01_VC03_sqrt"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-keyword">count</span>(sb.<span class="cm-string">"zipcode"</span>) over (</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">            partition <span class="cm-keyword">by</span> sb<span class="cm-variable-2">.zipcode</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        ) <span class="cm-keyword">as</span> num_of_sb,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        sb.<span class="cm-string">"City"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        sb.<span class="cm-string">"State"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        sb.<span class="cm-string">"Latitude"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        sb.<span class="cm-string">"Longitude"</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">from</span> zip_data_sb z</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">join</span> zip_data2 z2 <span class="cm-keyword">on</span> z2.<span class="cm-string">"Id"</span> = z.<span class="cm-string">"Id"</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">join</span> zip_data3 z3 <span class="cm-keyword">on</span> z3.<span class="cm-string">"Id"</span> = z.<span class="cm-string">"Id"</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    left <span class="cm-keyword">join</span> sb_stores sb <span class="cm-keyword">on</span> sb.<span class="cm-string">"zipcode"</span> = z.<span class="cm-string">"Id2"</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">join</span> cb_2015_us_zcta510_500k c <span class="cm-keyword">on</span> c<span class="cm-variable-2">.geoid</span><span class="cm-number">10</span>::bigint = z.<span class="cm-string">"Id2"</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">join</span> (</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-keyword">select</span> zip,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">            sum(case when naics ~ <span class="cm-string">'^445'</span> then est end)::bigint <span class="cm-keyword">as</span> <span class="cm-string">"grocery_stores"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">            sum(case when naics ~ <span class="cm-string">'^722'</span> then est end)::bigint <span class="cm-keyword">as</span> <span class="cm-string">"restaurants"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">            sum(case when naics ~ <span class="cm-string">'^311'</span> then est end)::bigint <span class="cm-keyword">as</span> <span class="cm-string">"manufacturing"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">            sum(case when naics ~ <span class="cm-string">'^54171'</span> <span class="cm-keyword">or</span> naics = <span class="cm-string">'518210'</span> then est end)::bigint <span class="cm-keyword">as</span> <span class="cm-string">"tech"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">            sum(case when naics ~ <span class="cm-string">'^611'</span> then est end)::bigint <span class="cm-keyword">as</span> <span class="cm-string">"colleges"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">            sum(case when naics = <span class="cm-string">'------'</span> then est end)::bigint <span class="cm-keyword">as</span> <span class="cm-string">"total"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">            sum(case when naics = <span class="cm-string">'531120'</span> then est end)::bigint <span class="cm-keyword">as</span> <span class="cm-string">"shopping_centers"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">            sum(case when naics ~ <span class="cm-string">'^23611'</span> then est end)::bigint <span class="cm-keyword">as</span> <span class="cm-string">"new_homes"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">            sum(case when naics ~ <span class="cm-string">'^5311'</span> then est end)::bigint <span class="cm-keyword">as</span> <span class="cm-string">"hotels"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">            sum(case when naics ~ <span class="cm-string">'^4411'</span> then est end)::bigint <span class="cm-keyword">as</span> <span class="cm-string">"car_dealers"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">            sum(case when naics ~ <span class="cm-string">'^4853'</span> then est end)::bigint <span class="cm-keyword">as</span> <span class="cm-string">"taxis"</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">            sum(case when naics = <span class="cm-string">'481111'</span> </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">                <span class="cm-keyword">or</span> naics <span class="cm-keyword">in</span> (<span class="cm-string">'485999'</span>, <span class="cm-string">'488119'</span>, <span class="cm-string">'488190'</span>) then est end)::bigint <span class="cm-keyword">as</span> <span class="cm-string">"airport_related"</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-keyword">from</span> zip_to_naics </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-keyword">group</span> <span class="cm-keyword">by</span> zip</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    ) zn <span class="cm-keyword">on</span> zn<span class="cm-variable-2">.zip</span> = z.<span class="cm-string">"Id2"</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">) s</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 1078px;"></div></div></div></div></div></div><div class="widget-area connection-problems" style="display: none;"><div class="prompt"><button class="close">×</button></div><div class="widget-subarea"></div></div><div class="output_wrapper"><div class=" prompt" title="click to scroll output; double click to hide" style=""></div><div class="output" style=""><div class="output_area"><div class="prompt"></div><div class="output_subarea output_html rendered_html">
        <style>
        .input { 
            position:relative; 
        }
        #childDivb2e59d29-7a68-41f2-a8b6-c619920e70be { 
            width: 90%;
            position:absolute; 
        }
        #tableb2e59d29-7a68-41f2-a8b6-c619920e70be{
            padding-top: 60px;
        }
        .page__content p {
            margin: inherit !important;
        }
        .smallfont {
            font-size: 12px !important;
        }
        </style>
        <div class="row" id="childDivb2e59d29-7a68-41f2-a8b6-c619920e70be">
            <div class="btn-group col-md-3">
                <button id="explain" title="Explain Analyze Graph" onclick="explain('__EXPLAIN_GRAPH__')" type="button" class="btn btn-info btn-sm"><p class="fa fa-code-fork fa-rotate-270" <="" p=""></p></button>
                <button id="explain" title="Explain Analyze" onclick="explain('__EXPLAIN__')" type="button" class="btn btn-info btn-sm"><p class="fa fa-info-circle" <="" p=""></p></button>
                <button type="button" title="Execute" onclick="run()" class="btn btn-success btn-sm"><p class="fa fa-play"></p></button>
                <button type="button" title="Execute and Return Data as Variable" onclick="getData()" class="btn btn-success btn-sm"><p class="">var</p></button>
                <button id="saveDatab2e59d29-7a68-41f2-a8b6-c619920e70be" title="Save" class="btn btn-success btn-sm" type="button"><p class="fa fa-save" <="" p=""></p></button>
                <button id="cancelQueryb2e59d29-7a68-41f2-a8b6-c619920e70be" title="Cancel Query" class="btn btn-danger btn-sm disabled" type="button"><p class="fa fa-stop" <="" p=""></p></button>
            </div>
            <div id="engineButtonsb2e59d29-7a68-41f2-a8b6-c619920e70be" class="btn-group col-md-4"><button title="Switch Engine" onclick="switchEngines('LOCAL')" class="btn btn-warning btn-sm">LOCAL</button><button title="Switch Engine" onclick="switchEngines('RDS')" class="btn btn-warning btn-sm">RDS</button><button title="Switch Engine" onclick="switchEngines('EC2')" class="btn btn-warning btn-sm">EC2</button></div>
            <div id="tableDatab2e59d29-7a68-41f2-a8b6-c619920e70be"><p class="smallfont" id="dbinfob2e59d29-7a68-41f2-a8b6-c619920e70be">To execute: 46.379 sec | Rows: 1 | DB: econ | Host: localhost</p></div>
        </div>
        <div class="table" id="tableb2e59d29-7a68-41f2-a8b6-c619920e70be"><svg width="2600" height="510"><g transform="translate(1,10)"><g><path class="link" d="M2339.7000000000003,171.97902055860433C2461.3500000000004,171.97902055860433 2461.3500000000004,171.97902055860433 2583,171.97902055860433" style="stroke-width: 343.958;"><title>WindowAgg -&gt; Subquery Scan<br>Total Cost: 1,107,480<br>Child Rows: 41,540<br>Parent Rows: 41,540</title></path><path class="link" d="M2081.4,170.20508189036926C2203.05,170.20508189036926 2203.05,170.20508189036926 2324.7000000000003,170.20508189036926" style="stroke-width: 340.41;"><title>Sort -&gt; WindowAgg<br>Total Cost: 1,096,057<br>Child Rows: 41,540<br>Parent Rows: 41,540</title></path><path class="link" d="M1823.1000000000001,160.45100426101894C1944.75,160.45100426101894 1944.75,152.89313779216738 2066.4,152.89313779216738" style="stroke-width: 305.786;"><title>Hash Join -&gt; Sort<br>Total Cost: 984,574<br>Child Rows: 41,540<br>Parent Rows: 41,540</title></path><path class="link" d="M1564.8000000000002,157.26341727552895C1686.4500000000003,157.26341727552895 1686.4500000000003,160.0615964996487 1808.1000000000001,160.0615964996487" style="stroke-width: 305.007;"><title>Hash Join -&gt; Hash Join<br>Total Cost: 982,067<br>Child Rows: 19,912<br>Parent Rows: 41,540</title></path><path class="link" d="M1306.5,151.95597454237307C1428.15,151.95597454237307 1428.15,156.7156617871049 1549.8000000000002,156.7156617871049" style="stroke-width: 303.912;"><title>Hash Join -&gt; Hash Join<br>Total Cost: 978,540<br>Child Rows: 19,991<br>Parent Rows: 19,912</title></path><path class="link" d="M1048.2,151.98525264422523C1169.85,151.98525264422523 1169.85,151.56556672278745 1291.5,151.56556672278745" style="stroke-width: 303.131;"><title>Hash Join -&gt; Hash Join<br>Total Cost: 976,025<br>Child Rows: 19,991<br>Parent Rows: 19,991</title></path><path class="link" d="M789.9000000000001,152.69555638730526C911.5500000000001,152.69555638730526 911.5500000000001,146.42611071250315 1033.2,146.42611071250315" style="stroke-width: 292.013;"><title>Hash -&gt; Hash Join<br>Total Cost: 940,227<br>Child Rows: 19,265<br>Parent Rows: 19,991</title></path><path class="link" d="M531.6,152.89123731469766C653.25,152.89123731469766 653.25,152.69555638730526 774.9000000000001,152.69555638730526" style="stroke-width: 292.013;"><title>Hash Join -&gt; Hash<br>Total Cost: 940,227<br>Child Rows: 19,265<br>Parent Rows: 19,265</title></path><path class="link" d="M273.3,152.36395723806777C394.95000000000005,152.36395723806777 394.95000000000005,151.59989040368768 516.6,151.59989040368768" style="stroke-width: 289.43;"><title>Aggregate -&gt; Hash Join<br>Total Cost: 931,911<br>Child Rows: 15,895<br>Parent Rows: 19,265</title></path><path class="link" d="M15,152.3627378301122C136.65,152.3627378301122 136.65,62.7572068889002 258.3,62.7572068889002" style="stroke-width: 110.217;"><title>Index Scan -&gt; Aggregate<br>Total Cost: 354,877<br>Child Rows: 8,377,036<br>Parent Rows: 15,895</title></path><path class="link" d="M789.9000000000001,350.2808681195848C911.5500000000001,350.2808681195848 911.5500000000001,294.0114224447827 1033.2,294.0114224447827" style="stroke-width: 3.15777;"><title>Seq Scan -&gt; Hash Join<br>Total Cost: 10,167<br>Child Rows: 33,144<br>Parent Rows: 19,991</title></path><path class="link" d="M273.3,347.8859314680512C394.95000000000005,347.8859314680512 394.95000000000005,297.12186463367107 516.6,297.12186463367107" style="stroke-width: 1.61379;"><title>Hash -&gt; Hash Join<br>Total Cost: 5,196<br>Child Rows: 38,711<br>Parent Rows: 19,265</title></path><path class="link" d="M15,258.277961710928C136.65,258.277961710928 136.65,347.8859314680512 258.3,347.8859314680512" style="stroke-width: 1.61379;"><title>Seq Scan -&gt; Hash<br>Total Cost: 5,196<br>Child Rows: 38,711<br>Parent Rows: 38,711</title></path><path class="link" d="M1306.5,354.3531067529916C1428.15,354.3531067529916 1428.15,309.11279399772343 1549.8000000000002,309.11279399772343" style="stroke-width: 1;"><title>Hash -&gt; Hash Join<br>Total Cost: 2,841<br>Child Rows: 32,989<br>Parent Rows: 19,912</title></path><path class="link" d="M1048.2,404.5588423317545C1169.85,404.5588423317545 1169.85,354.3531067529916 1291.5,354.3531067529916" style="stroke-width: 1;"><title>Seq Scan -&gt; Hash<br>Total Cost: 2,841<br>Child Rows: 32,989<br>Parent Rows: 32,989</title></path><path class="link" d="M1048.2,353.83425201526086C1169.85,353.83425201526086 1169.85,303.41456609382305 1291.5,303.41456609382305" style="stroke-width: 1;"><title>Hash -&gt; Hash Join<br>Total Cost: 1,825<br>Child Rows: 33,120<br>Parent Rows: 19,991</title></path><path class="link" d="M789.9000000000001,402.14318770904714C911.5500000000001,402.14318770904714 911.5500000000001,353.83425201526086 1033.2,353.83425201526086" style="stroke-width: 1;"><title>Seq Scan -&gt; Hash<br>Total Cost: 1,825<br>Child Rows: 33,120<br>Parent Rows: 33,120</title></path><path class="link" d="M1564.8000000000002,394.7383679103397C1686.4500000000003,394.7383679103397 1686.4500000000003,312.66819431982725 1808.1000000000001,312.66819431982725" style="stroke-width: 1;"><title>Hash -&gt; Hash Join<br>Total Cost: 662<br>Child Rows: 10,843<br>Parent Rows: 41,540</title></path><path class="link" d="M1306.5,404.89713221061857C1428.15,404.89713221061857 1428.15,394.7383679103397 1549.8000000000002,394.7383679103397" style="stroke-width: 1;"><title>Seq Scan -&gt; Hash<br>Total Cost: 662<br>Child Rows: 10,843<br>Parent Rows: 10,843</title></path></g><g><g class="node" transform="translate(2583,0)"><rect height="343.95804111720867" width="15" style="fill: rgb(255, 237, 160);"><title><br>Cost: 1,107,480<br>Time: 34858.369...46343.464<br>Rows: 41,540</title></rect><text x="-6" y="171.97902055860433" dy=".35em" text-anchor="end">Subquery Scan</text></g><g class="node" transform="translate(2324.7000000000003,0)"><rect height="343.95804111720867" width="15" style="fill: rgb(255, 237, 160);"><title><br>Cost: 1,107,480<br>Time: 34858.366...46320.764<br>Rows: 41,540</title></rect><text x="-6" y="171.97902055860433" dy=".35em" text-anchor="end">WindowAgg</text></g><g class="node" transform="translate(2066.4,0)"><rect height="340.4101637807385" width="15" style="fill: rgb(150, 150, 150);"><title><br>Cost: 1,096,057<br>Time: 34851.892...35085.608<br>Rows: 41,540</title></rect><text x="-6" y="170.20508189036926" dy=".35em" text-anchor="end">Sort</text></g><g class="node" transform="translate(1808.1000000000001,7.557866468851547)"><rect height="305.78627558433476" width="15" style="fill: rgb(150, 150, 150);"><title>((z."Id2")::double precision = sb.zipcode)<br>Cost: 984,574<br>Time: 34275.995...34513.029<br>Rows: 41,540</title></rect><text x="-6" y="152.89313779216738" dy=".35em" text-anchor="end">Hash Join</text></g><g class="node" transform="translate(1549.8000000000002,4.759687244731829)"><rect height="305.00746006159426" width="15" style="fill: rgb(150, 150, 150);"><title>(z2."Id" = z3."Id")<br>Cost: 982,067<br>Time: 34267.328...34477.469<br>Rows: 19,912</title></rect><text x="-6" y="152.50373003079713" dy=".35em" text-anchor="end">Hash Join</text></g><g class="node" transform="translate(1291.5,6.217248937900877e-15)"><rect height="303.91194908474614" width="15" style="fill: rgb(150, 150, 150);"><title>(z."Id" = z2."Id")<br>Cost: 978,540<br>Time: 34224.628...34408.843<br>Rows: 19,991</title></rect><text x="21" y="151.95597454237307" dy=".35em" text-anchor="start">Hash Join</text></g><g class="node" transform="translate(1033.2,0.41968592143778505)"><rect height="303.1311334455749" width="15" style="fill: rgb(150, 150, 150);"><title>((c.geoid10)::bigint = z."Id2")<br>Cost: 976,025<br>Time: 34180.378...34339.655<br>Rows: 19,991</title></rect><text x="21" y="151.56556672278745" dy=".35em" text-anchor="start">Hash Join</text></g><g class="node" transform="translate(774.9000000000001,348.70198117837066)"><rect height="3.1577738824283257" width="15" style="fill: rgb(150, 150, 150);"><title> using cb_2015_us_zcta510_500k c<br>Cost: 10,167<br>Time: 0.013...45.913<br>Rows: 33,144</title></rect><text x="21" y="1.5788869412141628" dy=".35em" text-anchor="start">Seq Scan</text></g><g class="node" transform="translate(774.9000000000001,6.689131596239894)"><rect height="292.01284958213074" width="15" style="fill: rgb(150, 150, 150);"><title><br>Cost: 940,227<br>Time: 34180.082...34180.082<br>Rows: 19,265</title></rect><text x="21" y="146.00642479106537" dy=".35em" text-anchor="start">Hash</text></g><g class="node" transform="translate(516.6,6.884812523632291)"><rect height="292.01284958213074" width="15" style="fill: rgb(227, 26, 28);"><title>(zip_to_naics.zip = z."Id2")<br>Cost: 940,227<br>Time: 67.502...34148.948<br>Rows: 19,265</title></rect><text x="21" y="146.00642479106537" dy=".35em" text-anchor="start">Hash Join</text></g><g class="node" transform="translate(258.3,7.648879358012372)"><rect height="289.4301557601108" width="15" style="fill: rgb(227, 26, 28);"><title>[u'zip_to_naics.zip']<br>Cost: 931,911<br>Time: 0.395...34033.649<br>Rows: 15,895</title></rect><text x="21" y="144.7150778800554" dy=".35em" text-anchor="start">Aggregate</text></g><g class="node" transform="translate(0,97.25441029922438)"><rect height="110.21665506177565" width="15" style="fill: rgb(150, 150, 150);"><title> using ix_zip zip_to_naics<br>Cost: 354,877<br>Time: 0.05...1954.643<br>Rows: 8,377,036</title></rect><text x="21" y="55.10832753088783" dy=".35em" text-anchor="start">Index Scan</text></g><g class="node" transform="translate(258.3,347.07903511812316)"><rect height="3" width="15" style="fill: rgb(150, 150, 150);"><title><br>Cost: 5,196<br>Time: 64.255...64.255<br>Rows: 38,711</title></rect><text x="21" y="0.8068963499280372" dy=".35em" text-anchor="start">Hash</text></g><g class="node" transform="translate(0,257.471065361)"><rect height="3" width="15" style="fill: rgb(150, 150, 150);"><title> using zip_data_sb z<br>Cost: 5,196<br>Time: 0.019...49.818<br>Rows: 38,711</title></rect><text x="21" y="0.8068963499280372" dy=".35em" text-anchor="start">Seq Scan</text></g><g class="node" transform="translate(1033.2,353.5508193670127)"><rect height="3" width="15" style="fill: rgb(150, 150, 150);"><title><br>Cost: 1,825<br>Time: 43.959...43.959<br>Rows: 33,120</title></rect><text x="21" y="0.28343264824814207" dy=".35em" text-anchor="start">Hash</text></g><g class="node" transform="translate(774.9000000000001,401.859755060799)"><rect height="3" width="15" style="fill: rgb(150, 150, 150);"><title> using zip_data2 z2<br>Cost: 1,825<br>Time: 0.007...32.568<br>Rows: 33,120</title></rect><text x="21" y="0.28343264824814207" dy=".35em" text-anchor="start">Seq Scan</text></g><g class="node" transform="translate(1291.5,353.91194908474614)"><rect height="3" width="15" style="fill: rgb(150, 150, 150);"><title><br>Cost: 2,841<br>Time: 42.435...42.435<br>Rows: 32,989</title></rect><text x="21" y="0.4411576682454878" dy=".35em" text-anchor="start">Hash</text></g><g class="node" transform="translate(1033.2,404.117684663509)"><rect height="3" width="15" style="fill: rgb(150, 150, 150);"><title> using zip_data3 z3<br>Cost: 2,841<br>Time: 0.006...32.48<br>Rows: 32,989</title></rect><text x="21" y="0.4411576682454878" dy=".35em" text-anchor="start">Seq Scan</text></g><g class="node" transform="translate(1549.8000000000002,394.6355001209583)"><rect height="3" width="15" style="fill: rgb(150, 150, 150);"><title><br>Cost: 662<br>Time: 8.579...8.579<br>Rows: 10,843</title></rect><text x="-6" y="0.10286778938144682" dy=".35em" text-anchor="end">Hash</text></g><g class="node" transform="translate(1291.5,404.79426442123713)"><rect height="3" width="15" style="fill: rgb(150, 150, 150);"><title> using sb_stores sb<br>Cost: 662<br>Time: 0.016...5.919<br>Rows: 10,843</title></rect><text x="21" y="0.10286778938144682" dy=".35em" text-anchor="start">Seq Scan</text></g></g></g></svg></div>
        <script type="text/Javascript">




        
            var engines = JSON.parse(`{"LOCAL": {"engine": "postgresql://tdobbins:tdobbins@localhost:5432/", "caution_level": "warning", "order": 0}, "EC2": {"engine": "postgresql://tmthyjames:1q2w3e4r5t@ec2-34-204-5-97.compute-1.amazonaws.com:5432/", "caution_level": "warning", "order": 1}, "RDS": {"engine": "postgresql://tmthyjames:1q2w3e4r5t@orionpax.cvb2tnvqksy5.us-east-1.rds.amazonaws.com:5432/", "caution_level": "warning", "order": 0}}`);
            
            var sortedEngineKeys = Object.keys(engines).sort(function(a,b){
                return engines[a].order - engines[b].order;
            });
            
            var sortedEngines = sortedEngineKeys.reduce(function(output, row, idx){
                engines[row]['key'] = row;
                output.push(engines[row]);
                return output;
            }, []);
            
            var engineButtons = '';
            for (var engine in sortedEngines){
                var engineKey = sortedEngines[engine].key;
                var warningLabel = sortedEngines[engine].caution_level;
                engineButtons += '<button title="Switch Engine" onclick="switchEngines('+"'"+engineKey+"'"+')" class="btn btn-'+warningLabel+' btn-sm">'+engineKey+'</button>';
            };
            
           $("#engineButtonsb2e59d29-7a68-41f2-a8b6-c619920e70be").append(engineButtons);
           
           $("#cancelQueryb2e59d29-7a68-41f2-a8b6-c619920e70be").on('click', function(){
               if ($("#cancelQueryb2e59d29-7a68-41f2-a8b6-c619920e70be").hasClass('disabled')){
                   console.log('alread stopped or finished query...');
               } else {
                   cancelQuery("bc3f9cef-42d0-4445-a0cd-b0e2d7791bcc");
                   //$("#cancelQueryb2e59d29-7a68-41f2-a8b6-c619920e70be").addClass('disabled')
               }
           });
        
            function explain(gloVar){
                var command =  `__SQLCell_GLOBAL_VARS__.`+gloVar+` = True`;
                console.log(command);
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                IPython.notebook.execute_cell();
            };
            
            function run(){
                IPython.notebook.execute_cell();
                $.get('/api/contents', function(data){
                    console.log(data);
                });
            };
            
            function cancelQuery(applicationID){
                IPython.notebook.kernel.execute('__SQLCell_GLOBAL_VARS__().kill_last_pid_on_new_thread(__SQLCell_GLOBAL_VARS__.jupyter_id, "econ", "b2e59d29-7a68-41f2-a8b6-c619920e70be")',
                    {
                        iopub: {
                            output: function(response) {
                                var $table = $("#tableb2e59d29-7a68-41f2-a8b6-c619920e70be").parent();
                                console.log(response);
                                if (response.content && response.content.text){
                                    $table.append('<h5 style="color:#d9534f;">'+response.content.text+'</h5>')
                                } else if (response.content && response.content.evalue){
                                    $table.append('<h5 style="color:#d9534f;">'+response.content.evalue+'</h5>');
                                }
                            }
                        }
                    },
                    {
                        silent: false, 
                        store_history: false, 
                        stop_on_error: true
                    }
                );
            };
            
            function getData(){
                var command = `__SQLCell_GLOBAL_VARS__.__GETDATA__ = True`;
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                IPython.notebook.execute_cell();
            };
            
            function saveData(data, filename){
                var path = $('#path').val() || './'
                var command = `__SQLCell_GLOBAL_VARS__.__SAVEDATA__, PATH = True,'`+path+`'`;
                var kernel = IPython.notebook.kernel;
                kernel.execute(command);
                //IPython.notebook.execute_cell();
                
                function download(data, filename, type) {
                    var a = document.createElement("a"),
                        file = new Blob([data], {type: type});
                    if (window.navigator.msSaveOrOpenBlob) // IE10+
                        window.navigator.msSaveOrOpenBlob(file, filename);
                    else { // Others
                        var url = URL.createObjectURL(file);
                        a.href = url;
                        a.download = filename;
                        document.body.appendChild(a);
                        a.click();
                        setTimeout(function() {
                            document.body.removeChild(a);
                            window.URL.revokeObjectURL(url);  
                        }, 0); 
                    }
                }
                
                download(data, filename, 'csv');
                
            };
            
            function switchEngines(engine){
                var command = "__SQLCell_GLOBAL_VARS__.ENGINE = " + "'" + engines[engine].engine + "econ" + "'";
                var kernel = IPython.notebook.kernel;
                kernel.execute(command,{
                    iopub: {
                        output: function(response) {
                            var $table = $("#tableb2e59d29-7a68-41f2-a8b6-c619920e70be").parent();
                            console.log(response);
                            if (response.content && response.content.text){
                                $table.append('<h5 style="color:#d9534f;">'+response.content.text+'</h5>')
                            } else if (response.content && response.content.evalue){
                                $table.append('<h5 style="color:#d9534f;">'+response.content.evalue+'</h5>');
                            }
                        }
                    }
                },
                    {
                        silent: false, 
                        store_history: false, 
                        stop_on_error: true
                    }
                );
                IPython.notebook.execute_cell();
            };

        </script>
        </div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_javascript rendered_html"></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_html rendered_html">
        <style>
        .node rect {
          cursor: move;
          fill-opacity: .9;
          shape-rendering: crispEdges;
        }

        .node text {
          pointer-events: none;
          text-shadow: 0 0px 0 #fff;
        }

        .link {
          fill: none;
          stroke: #000;
          stroke-opacity: .2;
        }

        .link:hover {
          stroke-opacity: .5;
        }
        div.output_area img, div.output_area svg{ 
            max-width:none;
        }
        </style>
        <div id="tableb2e59d29-7a68-41f2-a8b6-c619920e70be"></div>
        <script>
        var margin = {top: 10,right: 1,bottom: 6,left: 1},
            width = Math.max(2600, 1000) - margin.left - margin.right,
            height = 500 - margin.bottom;

        var formatNumber = d3.format(",.0f"),
            format = function(d) {
                return formatNumber(d);
            },
            color = d3.scale.category20();

        var svg = d3.select('#tableb2e59d29-7a68-41f2-a8b6-c619920e70be').append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var sankey = d3.sankey()
            .nodeWidth(15)
            .nodePadding(50)
            .size([width, height]);

        var path = sankey.link();
        var energy = {"executionTime": 46356.511, "nodes": [{"xPos": 10, "rows": 41540, "nodetype": "Subquery Scan", "name": 4651973160, "starttime": 34858.369, "subplan": null, "endtime": 46343.464, "display": ""}, {"xPos": 9, "rows": 41540, "nodetype": "WindowAgg", "name": 4651973440, "starttime": 34858.366, "subplan": null, "endtime": 46320.764, "display": ""}, {"xPos": 8, "rows": 41540, "nodetype": "Sort", "name": 4651972600, "starttime": 34851.892, "subplan": null, "endtime": 35085.608, "display": ""}, {"xPos": 7, "rows": 41540, "nodetype": "Hash Join", "name": 4651972320, "starttime": 34275.995, "subplan": null, "endtime": 34513.029, "display": "((z.\"Id2\")::double precision = sb.zipcode)"}, {"xPos": 6, "rows": 19912, "nodetype": "Hash Join", "name": 4651405952, "starttime": 34267.328, "subplan": null, "endtime": 34477.469, "display": "(z2.\"Id\" = z3.\"Id\")"}, {"xPos": 5, "rows": 19991, "nodetype": "Hash Join", "name": 4651053136, "starttime": 34224.628, "subplan": null, "endtime": 34408.843, "display": "(z.\"Id\" = z2.\"Id\")"}, {"xPos": 4, "rows": 19991, "nodetype": "Hash Join", "name": 4651967664, "starttime": 34180.378, "subplan": null, "endtime": 34339.655, "display": "((c.geoid10)::bigint = z.\"Id2\")"}, {"xPos": 3, "rows": 33144, "nodetype": "Seq Scan", "name": 4651985168, "starttime": 0.013, "subplan": null, "endtime": 45.913, "display": " using cb_2015_us_zcta510_500k c"}, {"xPos": 3, "rows": 19265, "nodetype": "Hash", "name": 4651968224, "starttime": 34180.082, "subplan": null, "endtime": 34180.082, "display": ""}, {"xPos": 2, "rows": 19265, "nodetype": "Hash Join", "name": 4651967944, "starttime": 67.502, "subplan": null, "endtime": 34148.948, "display": "(zip_to_naics.zip = z.\"Id2\")"}, {"xPos": 1, "rows": 15895, "nodetype": "Aggregate", "name": 4651373184, "starttime": 0.395, "subplan": null, "endtime": 34033.649, "display": "[u'zip_to_naics.zip']"}, {"xPos": 0, "rows": 8377036, "nodetype": "Index Scan", "name": 4651375144, "starttime": 0.05, "subplan": null, "endtime": 1954.643, "display": " using ix_zip zip_to_naics"}, {"xPos": 1, "rows": 38711, "nodetype": "Hash", "name": 4651967104, "starttime": 64.255, "subplan": null, "endtime": 64.255, "display": ""}, {"xPos": 0, "rows": 38711, "nodetype": "Seq Scan", "name": 4651966824, "starttime": 0.019, "subplan": null, "endtime": 49.818, "display": " using zip_data_sb z"}, {"xPos": 4, "rows": 33120, "nodetype": "Hash", "name": 4651488992, "starttime": 43.959, "subplan": null, "endtime": 43.959, "display": ""}, {"xPos": 3, "rows": 33120, "nodetype": "Seq Scan", "name": 4651968784, "starttime": 0.007, "subplan": null, "endtime": 32.568, "display": " using zip_data2 z2"}, {"xPos": 5, "rows": 32989, "nodetype": "Hash", "name": 4651405672, "starttime": 42.435, "subplan": null, "endtime": 42.435, "display": ""}, {"xPos": 4, "rows": 32989, "nodetype": "Seq Scan", "name": 4651287728, "starttime": 0.006, "subplan": null, "endtime": 32.48, "display": " using zip_data3 z3"}, {"xPos": 6, "rows": 10843, "nodetype": "Hash", "name": 4651314544, "starttime": 8.579, "subplan": null, "endtime": 8.579, "display": ""}, {"xPos": 5, "rows": 10843, "nodetype": "Seq Scan", "name": 4651094096, "starttime": 0.016, "subplan": null, "endtime": 5.919, "display": " using sb_stores sb"}], "depth": 13, "links": [{"source": 1, "target": 0, "value": 1107480.42}, {"source": 2, "target": 1, "value": 1096056.92}, {"source": 3, "target": 2, "value": 984574.49}, {"source": 4, "target": 3, "value": 982066.85}, {"source": 5, "target": 4, "value": 978539.51}, {"source": 6, "target": 5, "value": 976025.43}, {"source": 7, "target": 6, "value": 10167.44}, {"source": 8, "target": 6, "value": 940226.64}, {"source": 9, "target": 8, "value": 940226.64}, {"source": 10, "target": 9, "value": 931910.85}, {"source": 11, "target": 10, "value": 354876.97}, {"source": 12, "target": 9, "value": 5196.11}, {"source": 13, "target": 12, "value": 5196.11}, {"source": 14, "target": 5, "value": 1825.2}, {"source": 15, "target": 14, "value": 1825.2}, {"source": 16, "target": 4, "value": 2840.89}, {"source": 17, "target": 16, "value": 2840.89}, {"source": 18, "target": 3, "value": 662.43}, {"source": 19, "target": 18, "value": 662.43}]}
        var executionTime = energy.executionTime
        energy = {
            nodes: energy.nodes,
            links: energy.links
        };
        sankey
            .nodes(energy.nodes)
            .links(energy.links)
            .layout(32);
        var link = svg.append("g").selectAll(".link")
            .data(energy.links)
            .enter().append("path")
            .attr("class", "link")
            .attr("d", path)
            .style("stroke-width", function(d) {
                return Math.max(1, d.dy);
            })
            .sort(function(a, b) {
                return b.dy - a.dy;
            });

        link.append("title")
            .html(function(d) {
                return d.source.nodetype + " -> " 
                    + d.target.nodetype + "<br/>" 
                    + 'Total Cost: ' + format(d.value) + "<br/>"
                    + 'Child Rows: ' + format(d.source.rows) + "<br/>"
                    + 'Parent Rows: ' + format(d.target.rows);
            });

        var node = svg.append("g").selectAll(".node")
            .data(energy.nodes)
            .enter().append("g")
            .attr("class", "node")
            .attr("transform", function(d) {
                return "translate(" + d.x + "," + d.y + ")";
            })
            .call(d3.behavior.drag()
                .origin(function(d) {
                    return d;
                })
                .on("dragstart", function() {
                    this.parentNode.appendChild(this);
                })
                .on("drag", dragmove));

        node.append("rect")
            .attr("height", function(d) {
                return Math.max(d.dy, 3);
            })
            .attr("width", sankey.nodeWidth())
            .style("fill", function(d) {
                if ((d.endtime - d.starttime) > (executionTime * 0.9)) return d.color = "#800026"
                else if ((d.endtime - d.starttime) > (executionTime * 0.8)) return d.color = "#bd0026"
                else if ((d.endtime - d.starttime) > (executionTime * 0.7)) return d.color = "#e31a1c"
                else if ((d.endtime - d.starttime) > (executionTime * 0.6)) return d.color = "#fc4e2a"
                else if ((d.endtime - d.starttime) > (executionTime * 0.5)) return d.color = "#fd8d3c"
                else if ((d.endtime - d.starttime) > (executionTime * 0.4)) return d.color = "#feb24c"
                else if ((d.endtime - d.starttime) > (executionTime * 0.3)) return d.color = "#fed976"
                else if ((d.endtime - d.starttime) > (executionTime * 0.2)) return d.color = "#ffeda0"
                else if ((d.endtime - d.starttime) > (executionTime * 0.1)) return d.color = "#ffffcc"
                else return d.color = "#969696"
            })
            .append("title")
            .html(function(d) { 
                return (d.display || '') + "<br/>Cost: " 
                    + formatNumber(d.value) + "<br/>Time: " 
                    + d.starttime + '...' + d.endtime
                    + '<br/>Rows: ' + formatNumber(d.rows);
            });

        node.append("text")
            .attr("x", -6)
            .attr("y", function(d) {
                return d.dy / 2;
            })
            .attr("dy", ".35em")
            .attr("text-anchor", "end")
            .attr("transform", null)
            .text(function(d) {
                return d.subplan || d.nodetype;
            })
            .filter(function(d) {
                return d.x < width / 2;
            })
            .attr("x", 6 + sankey.nodeWidth())
            .attr("text-anchor", "start");

        function dragmove(d) {
            d3.select(this).attr("transform", "translate(" + d.x + "," + (d.y = Math.max(0, Math.min(height - d.dy, d3.event.y))) + ")");
            sankey.relayout();
            link.attr("d", path);
        }
        </script>
        </div></div></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div>